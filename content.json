{"pages":[],"posts":[{"title":"åˆ«åªå°†Codableç”¨æ¥è§£Json,-ç©è½¬ä½ çš„æ¨¡å‹å§---","text":"åˆ«åªå°†Codableç”¨æ¥è§£Json,-ç©è½¬ä½ çš„æ¨¡å‹å§ æœ¬æ–‡ä»£ç ä½¿ç”¨Swift 4 ä»£ç :https://github.com/jamesdouble/JDSwiftHeatMap å‰è¨€è‡ªä» Swift 4 å‡ºæ¥ä¹‹åï¼ˆç°å·²4.1ï¼‰ï¼Œç›¸ä¿¡ä¸å°‘è¯»è€…å·²ç»çœ‹è¿‡æ— æ•°å›½å†…å¤–ç¯‡çš„æ–‡ç« åœ¨ä»‹ç» Swift 4 å½“ä¸­çš„ä¸€ä¸ªæ–°åŠŸèƒ½ Codableï¼Œä¹‹æ‰€ä»¥ä¼šç«ï¼Œä¸å¤–ä¹å°±æ˜¯ä¸ºä¸€ä¸ªç›®å‰æ™®éä¸šåŠ¡ä¸Šå¯¹ä¼ºæœå™¨å›è°ƒJson -&gt; è‡ªå®šä¹‰æ¨¡å‹è¿™ä¸ªæµç¨‹å¼€äº†ä¸€æ¡æ·å¾„ï¼Œä¹Ÿé™„åŠ äº†ä¸å°‘å¼¹æ€§ã€‚æœ¬ç¯‡æ–‡ç« ä¸æ˜¯ç€é‡äºCodableçš„åè®®æˆ–æ˜¯è½¬æ¢ï¼Œè€Œæ˜¯Codableèƒ½å¸®åŠ©æˆ‘è§£å†³ä»¥ä¸‹çš„é—®é¢˜ï¼Œæ‰€ä»¥å…¶ä»–å°±ä¸èµ˜è¿°äº†ã€‚ Custom Encoding and Decoding åªå…³å¿ƒCodableå¯è·³åˆ°ç”¨Codableéšæœºè‡ªå®šä¹‰æ¨¡å‹ Problemæœ€è¿‘åœ¨å·¥ä½œä¸Šåšäº†å‡ ä¸ªç±»ä¼¼å•å…ƒå¼€å‘çš„æµ‹è¯•ï¼Œéœ€è¦å¤§é‡çš„æµ‹è¯•é¢å¯¹å„å‹å„æ ·çš„æ•°æ®UIèƒ½å¦æ­£å¸¸å±•ç¤ºï¼Œéœ€è¦ä¸€ä¸ªèƒ½å°†è‡ªå·±æ¨¡å‹æ•°æ®éšæœºåŒ–çš„ä¸€ä¸ªæ¡†æ¶ã€‚ ç¬¬ä¸€æ—¶é—´å½“ç„¶æ˜¯æ‰¾æ‰¾æœ‰æ²¡æœ‰ç¬¦åˆçš„æ¡†æ¶èƒ½ç”¨ğŸ˜…ğŸ˜…ï¼Œå„ç§å…³é”®å­—ç»„åˆæœç´¢åï¼Œè¿˜æ˜¯æ²¡çœ‹åˆ°èƒ½è¾¾æˆè¿™å—éœ€æ±‚çš„ï¼ˆå¯èƒ½æ˜¯æˆ‘æ²¡æœç´¢åˆ°ï¼Œåœ¨è¿™ä¹Ÿæ±‚ä»‹ç»ï¼‰ï¼Œ æœ€åè¿˜æ˜¯å†³å®šè‡ªå·±æ¥å†™ä¸€ä¸ªé˜³æ˜¥ç‰ˆçš„æ¨¡å‹éšæœºæ¡†æ¶ã€‚ ç›®çš„12345678910struct MyStruct { var opt: Int var opt2: Int}foo = æŸfunction(MyStruct)foo.opt // 4242foo.opt2 // 1234 åˆæ­¥Approachè¦èƒ½åšåˆ°æŠŠè‡ªå·±è‡ªå®šä¹‰çš„æ¨¡å‹äº¤ç»™ç¨‹åºå»éšæœºï¼Œå°±ä¸€å®šå¾—ä»åŠ¨æ€è°ƒç”¨èµ·æ‰‹ï¼Œå¦åˆ™æ¡†æ¶å°±æ— æ³•å¾—çŸ¥ä½ è‡ªå®šä¹‰çš„æ¨¡å‹ å˜é‡åï¼Œå˜é‡çš„å‹åˆ«â€¦ç­‰ï¼Œè¿›è€Œæ— æ³•é’ˆå¯¹ä½ çš„å˜é‡æ‰“ä¹±ã€‚ ä»¥ä¸‹æˆ‘å°±å°è¯•äº†å‡ ä¸ªå¸¸ç”¨çš„åŠ¨æ€è°ƒç”¨ï¼Œæ¯”è¾ƒä»–ä»¬å„è‡ªçš„ä¼˜ç¼ºï¼š å•çº¯ä½¿ç”¨ Mirror + Protocol ç¼ºå°‘è¯¸å¤šå·²çŸ¥è¦ç´  åœ¨é™æ€è°ƒç”¨ç¯å¢ƒä¸‹çš„Swift, Mirrorç®—æ˜¯æ¯”è¾ƒç‰¹æ®Šäº†ï¼Œè™½ç„¶æ²¡æœ‰Runtimeç‰›ï¼ˆAppleç®¡å®ƒå«åšåå°„ï¼‰ï¼Œä½†ä¹Ÿæ˜¯ä¸ªå¾ˆå¥½ç”¨çš„æ¡†æ¶ã€‚ ä¼˜ç‚¹ï¼š å¯å…¼å®¹ä»»ä½•è‡ªå®šä¹‰çš„Struct, Classï¼Œä¸”æ˜¯çº¯Swiftã€‚ ç¼ºç‚¹ï¼š å› ä¸ºä¸å»é™åˆ¶ç‰¹å®šçš„å·²çŸ¥ç±»å‹ï¼Œæ•…åªèƒ½è¯†åˆ«å®ƒçš„å˜é‡ç±»å‹è·Ÿè¯»å–å˜é‡æ•°å€¼ï¼Œå¹¶æ²¡æœ‰é™„å¸¦åè¿‡æ¥èµ‹å€¼çš„é€šé“ã€‚ æ€§èƒ½è¾ƒå·®ã€‚ æ²¡æœ‰åŠæ³•åšæ ‘çŠ¶å¤„ç†ã€‚ ä½¿ç”¨Protocolæ‰‹åŠ¨èµ‹å€¼ éœ€è¦æ‰‹åŠ¨å»åˆ¤æ–­æ¯ä¸ªå›ä¼ å›æ¥çš„keyå†è‡ªè¡Œå»èµ‹å€¼ï¼Œå®Œå…¨æ˜¯ä¸å¯è¡Œçš„æ–¹æ³•ã€‚ åŒä¸Šç¼ºç‚¹ï¼Œä½¿ç”¨Mirrorä¸€å®šå¾—æ”¾å°½ä¸€ä¸ªå®ä¾‹ï¼Œä¸èƒ½åªä¼ Typeï¼Œå…¨å†™å‡ºæ¥å…¶å®ä¹Ÿä¸å•çº¯äº†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738protocol RandProtocol { mutating func randResult(key: String, value: Any) static func initRand() -&gt; RandProtocol}struct JamesStruct: RandProtocol { var opt: Int = 0 mutating func randResult(key: String, value: Any) { if key == &quot;opt&quot; { if let intvalue = value as? Int { self.opt = intvalue } } } static func initRand() -&gt; RandProtocol { return JamesStruct() }}class RandMyMod&lt;T: RandProtocol&gt; { func randByMirror() -&gt; T { guard var newObject: T = T.initRand() as? T else { fatalError() } let mirror = Mirror(reflecting: newObject) for child in mirror.children { if child.value is Int { newObject.randResult(key: child.label!, value: (Int(arc4random_uniform(100) + 1))) } else if child.value is Float { /// } } return newObject }}let james = RandMyMod&lt;JamesStruct&gt;().randByMirror()james.opt æœ€æ–¹ä¾¿ä½†é™åˆ¶å¤š NSObject ä¼˜ç‚¹ï¼š ç»§æ‰¿çš„Classå¯ä»¥å…±ç”¨NSObjectçš„init()æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨ä½¿ç”¨æ—¶è¦ä¼ è¿›ä¸€ä¸ªå®ä¾‹ï¼Œèƒ½ç›´æ¥ä»Type T åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ T()ï¼Œå³å¯å¯¹ä»–è¿›è¡Œèµ‹å€¼ã€‚ æ‹¥æœ‰æ–¹æ³•.value(forKey:)ï¼Œåªè¦èƒ½å–å¾—å˜é‡åç§°å°±èƒ½å–å¾—å˜é‡æ•°å€¼ï¼Œè¿›è€Œç”¨æ­¤æ•°å€¼åˆ¤æ–­ä¹‹åè¦setçš„Valueæ˜¯ä»€ä¹ˆæ ·çš„ç±»å‹ï¼Œå½“ç„¶åœ¨NSObjecté‡Œè¦å–å¾—å˜é‡åç§°ä¹Ÿä¸éš¾ã€‚ ç¼ºç‚¹ï¼š å¿…é¡»è¦ç»§æ‰¿ NSObjectï¼Œä½†ä¸ªäººåå¥½ä½¿ç”¨ struct æ¥å®ä½œå¤§éƒ¨åˆ†çš„Dataæ¨¡å‹ï¼Œä¹Ÿä»£è¡¨æ²¡åŠæ³•ä½¿ç”¨ä»»ä½•ç»§æ‰¿ã€‚ åœ¨æ­¤Classä¸‹çš„ä»»ä½•è‡ªå®šä¹‰æ¨¡å‹çš„å˜é‡ä¹Ÿå¿…é¡»è¦æ˜¯NSObjectï¼Œæ‰èƒ½åšæ ‘çŠ¶çš„éšæœºï¼Œå¦åˆ™å°†åœæ­¢ã€‚ 1234567class A: NSObject { var foo: B //æ­¤å˜é‡æ— æ³•è¢«è¯†åˆ«, ä¹Ÿæ— æ³•è¢«æ›´æ”¹}class B { var num: Int} æ­é…Runtime 12345678910111213141516171819202122class James: NSObject { @objc var opt: Int = 0 @objc var opt2: Int = 0}class RandMyMod&lt;T: NSObject&gt; { func rand() -&gt; T { var count: UInt32 = 0 var newObject: T = T() guard let properties = class_copyPropertyList(T.self, &amp;count) else { fatalError() } for i in 0..&lt;count { let pro = properties[Int(i)] let name = property_getName(pro) let str = String(cString: name) newObject.setValue(Int(arc4random_uniform(100) + 1), forKey: str) } return newObject }}let james = RandMyMod&lt;James&gt;().rand()james.opt // == 20james.opt2 // == 45 è¯´åˆ°æœ€å®Œå–„æœ€opçš„åŠ¨æ€è°ƒç”¨ï¼Œè‚¯å®šæ˜¯Objective-Cå‘çš„Runtimeäº†ï¼Œè®¾ç½®æœ€å°‘ä¹Ÿæœ€ç›´è§‚ï¼Œæˆ‘ä¹‹æ‰€ä»¥æœ€åä¸é‡‡ç”¨çš„åŸå› ï¼š ç›®å‰æ¡†æ¶æ•´ä½“æ–¹å‘è¿˜æ˜¯å¸Œæœ›èƒ½ä»¥çº¯Swiftä¸ºä¸»ï¼Œä¸æƒ³ä½¿ç”¨ç±»OCæ–¹æ³•ã€‚ æœ‰ä½¿ç”¨RunTimeçš„æ¡†æ¶å¯¹äºä¸»ç¨‹åºçš„ä¾µå…¥æ€§è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œå¸Œæœ›æ­¤æ¡†æ¶æ˜¯ä»¥è¾…åŠ©æ€§çš„å·¥å…·ç±»ä¸ºä¸»ã€‚ æ­é…Mirror 12345678910111213141516171819class RandMyMod&lt;T: NSObject&gt; { func randByMirror() -&gt; T { var newObject: T = T() let mirror = Mirror(reflecting: T()) for child in mirror.children { if child.value is Int { newObject.setValue(Int(arc4random_uniform(100) + 1), forKey: child.label!) } else if child.value is Float { /// } } return newObject }}let james2 = RandMyMod&lt;James&gt;().randByMirror()james2.opt // == 55james2.opt2 // == 74 Mirror åœ¨å–å¾—å˜é‡åç§°ä¸å˜é‡ç±»å‹çš„åˆ¤æ–­ä¸Šæ˜æ˜¾æ¯”çœ‹èµ·æ¥ç®€æ˜“è®¸å¤šï¼Œä½†ä»–çš„å±€é™æ€§å…¶å®è·ŸRuntimeå·®ä¸å¤šï¼Œæ•ˆèƒ½ç”šè‡³æ¯”Runtimeè·Ÿå·®ï¼Œè‹¥æ˜¯å˜é‡æ•°é‡è¾ƒå¤šä¼šå¯¼è‡´å½±å“åˆ°çº¿ç¨‹çš„è¿è¡Œã€‚ å¹³å‡éœ€æ±‚ Codableå…ˆè¯´Codableè·ŸåŠ¨æ€è°ƒç”¨å…¶å®ä¸€ç‚¹æ¯›å…³ç³»ä¹Ÿæ²¡æœ‰ï¼Œç¬¬ä¸€æ—¶é—´ä¹Ÿæ˜¯æ²¡æƒ³åˆ°çš„ï¼Œä½†å¹³å‡äº†ä»¥ä¸Šä¸¤ä¸ªçš„ä¼˜ç¼ºï¼Œæˆ‘å´å‘ç°Codableèƒ½æ¶µç›–å‡ ä¸ªé—®é¢˜çš„ä¼˜åŒ–ï¼š Struct, Class éƒ½èƒ½ä½¿ç”¨ï¼Œå› ä¸ºCodableæ˜¯åè®® èµ‹å€¼é—®é¢˜ï¼Œè¯´æ˜¯jsonè‡ªåŠ¨ç”Ÿæˆæ¨¡å‹å®ä¾‹ï¼Œé‚£ç†è§£æˆç”¨jsonè‡ªåŠ¨èµ‹å€¼ç»™ä¸€ä¸ªæ¨¡å‹ï¼Œæ²¡å•¥æ¯›ç—… æ²¡æœ‰ä½¿ç”¨Mirror æˆ–æ˜¯ Runtime æ•ˆèƒ½æ¶ˆè€—å¾ˆä½ï¼Œå‡ ä¹æ˜¯å•çº¯çš„æ”¹å€¼è€Œå·² å”¯ä¸€æ¯”è¾ƒæ²¡æ³•åœ¨æ›´ä¼˜åŒ–(æˆ–æ˜¯æˆ‘æ²¡æƒ³åˆ°)çš„ä¸¤ç‚¹ï¼š æ— æ³•å•çº¯ä½¿ç”¨ Codable type å»åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ è‹¥è¦åšæ ‘çŠ¶çš„éšæœºï¼Œå˜é‡ä¹Ÿå¾—æ˜¯Codableã€‚ 12345678910111213class Man: Codable { var name: String = &quot;&quot; var address: String = &quot;&quot; var website: [String] = []} let man = Man()RandMyMod&lt;Man&gt;().randMe(baseOn: man) { (newMan) in guard let new = newMan else { return } print(new.address) //mnxvpkalug print(new.name) //iivjohpggb print(new.website) //[&quot;pbmsualvei&quot;, &quot;vlqhlwpajf&quot;, &quot;npgtxdmfyt&quot;]} Implementæ•´ä¸ªæµç¨‹å¾ˆå•çº¯å°±æ˜¯ï¼š å®ä¾‹ encode æˆ Data 12func randMe(baseOn instance: T, completion: (T?)-&gt; ()) { let jsonData = try JSONEncoder().encode(instance) Data è½¬æˆ Dictionary 1let jsonDic = try JSONSerialization.jsonObject(with: jsonData, options: .mutableContainers) éšæœºDictionaryçš„å…ƒç´  åŸºæœ¬ä¸ŠåŸæœ¬æœ€å¤æ‚çš„å–å€¼èµ‹å€¼é—®é¢˜ï¼ŒCodableéƒ½å·²ç»å¤§å®¶å¸¸ç”¨çš„æ ‡å‡†æ–¹æ³•äº†ï¼Œæ‰€ä»¥æœ¬æ¡†æ¶å°±åªéœ€è¦åœ¨è¿™ä¸€æ­¥ï¼Œå¤„ç†æ ‘çŠ¶çš„é€’å›éšæœºï¼Œå¹¶ç€å¢¨ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚ æ ‘çŠ¶çš„é€’å›éšæœº ä¸»è¦å¤„ç†åªåœ¨è¿™ä¸ªç±»RandFactoryï¼š å®ƒçš„initï¼ˆæ³¨å…¥ä¸€ä¸ª Value: Any, keyå˜é‡å: String)ï¼Œå¤–éƒ¨è°ƒä»–çš„function - randData() å³å¯è·å¾—è·Ÿæ³¨å…¥åŒç±»å‹çš„ï¼Œä¸”å·²éšæœºçš„å€¼ã€‚ å¯æ³¨å…¥çš„ç±»å‹åŒ…æ‹¬String, Int, Floatâ€¦.ç­‰å¯éšæœºçš„ç±»å‹ï¼Œè¿˜åŒ…æ‹¬æœ€é‡è¦çš„Dictionaryã€‚ è‹¥ç±»å‹æ˜¯ Dictionary**(ç±»å‹æ˜¯å­—å…¸ï¼Œä»£è¡¨ä»–ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„Codableæ¨¡å‹)ï¼Œéå†é‡Œé¢çš„å…ƒç´ ï¼Œå°†å…ƒç´ åœ¨åšä¸€æ¬¡RandFactory**ï¼Œå¹¶ç”¨æ–°å€¼æ›´æ–°Dictionaryï¼Œè¾¾åˆ°é€’å›ã€‚ 1234for (_, variable) in dictionary.enumerated() { let factory = RandFactory(variable.value, variable.key, specificBlock: specificBlock, delegate: delegate).randData() dictionary.updateValue(factory, forKey: variable.key) } é™„åŠ åŠŸèƒ½ å¯ä»¥åšåˆ°å¿½ç•¥ç‰¹å®šå˜é‡ï¼ŒæŒ‡å®šç±»å‹éšæœºç§å­â€¦.ç­‰ï¼Œè¿™é‡Œä¸èµ˜è¿° Dictionary ä¼ æˆ Data 1let jsonData = try JSONSerialization.data(withJSONObject: newDicionary, options: .prettyPrinted) Data Decode æˆ å®ä¾‹ 12let decoder = JSONDecoder() let newinstance = try decoder.decode(T.self, from: jsonData) Final Example123456789101112131415161718192021222324252627282930313233343536373839404142434445464748struct Man: Codable { var name: String = &quot;&quot; var age: Int = 40 var website: [String] = [] var child: Child = Child()}struct Child: Codable { var name: String = &quot;Baby&quot; //Baby has no name yet. var age: Int = 2 var toy: Toys = Toys()}class Toys: Codable { var weight: Double = 0.0}extension Man: RandMyModDelegate { func shouldIgnore(for key: String, in Container: String) -&gt; Bool { switch (key, Container) { case (&quot;name&quot;,&quot;child&quot;): return true default: return false } } func specificRandType(for key: String, in Container: String, with seed: RandType) -&gt; (() -&gt; Any)? { switch (key, Container) { case (&quot;age&quot;,&quot;child&quot;): return { return seed.number.randomInt(min: 1, max: 6)} case (&quot;weight&quot;,_): return { return seed.number.randomFloat() } default: return nil } }}let man = Man()RandMyMod&lt;Man&gt;().randMe(baseOn: man) { (newMan) in guard let child = newMan?.child else { print(&quot;no&quot;); return } print(child.name) //Baby print(child.age) //3 print(child.toy.weight) //392.807067871094}","link":"/blog/2018/04/24/CodableModel/"},{"title":"(Xcode) ç·¨è­¯å™¨å°ç™½ç­†è¨˜ - LLVMå‰ç«¯Clang","text":"(Xcode) ç·¨è­¯å™¨å°ç™½ç­†è¨˜ - LLVMå‰ç«¯Clang æœ¬æ–‡ä¸ºç¬”è®°å‹å¼å‘ˆç°ï¼Œå¹¶éå…¨éƒ¨åŸåˆ›ï¼Œæ¥æºè§æ–‡æœ« Compiler Clang - LLVMAppleï¼ˆåŒ…æ‹¬ä¸­åæœŸçš„NeXTï¼‰ ä¸€ç›´ä½¿ç”¨GCCä½œä¸ºå®˜æ–¹çš„ç¼–è¯‘å™¨ã€‚GCCä½œä¸ºå¼€æºä¸–ç•Œçš„ç¼–è¯‘å™¨æ ‡å‡†ä¸€ç›´åšå¾—ä¸é”™ï¼Œä½†Appleå¯¹ç¼–è¯‘å·¥å…·ä¼šæå‡ºæ›´é«˜çš„è¦æ±‚ã€‚ Clangè¿™ä¸ªè½¯ä½“ä¸“æ¡ˆåœ¨2005å¹´ç”±è‹¹æœç”µè„‘å‘èµ·ï¼Œæ˜¯LLVMç¼–è¯‘å™¨å·¥å…·é›†çš„å‰ç«¯ï¼ˆfront-endï¼‰ï¼Œç›®çš„æ˜¯è¾“å‡ºç¨‹å¼ç å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ï¼Œå¹¶å°†ç¨‹å¼ç ç¼–è¯‘æˆLLVM Bitcodeã€‚æ¥ç€åœ¨åç«¯ï¼ˆback-endï¼‰ä½¿ç”¨LLVMç¼–è¯‘æˆå¹³å°ç›¸å…³çš„æœºå™¨è¯­è¨€ ã€‚ å…ˆçœ‹ç»“æœmain.m 1234567891011121314#import &lt;Foundation/Foundation.h&gt;#define DEFINEEight 8int main(){ @autoreleasepool { int eight = DEFINEEight; int six = 6; NSString* site = [[NSString alloc] initWithUTF8String:&quot;starming&quot;]; int rank = eight + six; NSLog(@&quot;%@ rank %d&quot;, site, rank); } return 0;} ç›´æ¥ç¼–è¯‘æˆæ‰§è¡Œæ¡£ clang -fmodules main.m äº§å‡º .out (executable) Clang (Frontendå‰ç«¯)æ˜¯ä¸€ä¸ªCã€C++ã€Objective-Cå’ŒObjective-C++ç¨‹å¼è¯­è¨€çš„ç¼–è¯‘å™¨å‰ç«¯ Clangæºç ç»“æ„ Clangæ­¥éª¤clang -ccc-print-phases main.m 1.Input (Driver)æŒ‡å®šè¯­è¨€ , æ¶æ„, è¾“å…¥file clang -x objective-c main.m 2.Preprocessor(é¢„å¤„ç†)import å¤´æ–‡ä»¶, includeå¤´æ–‡ä»¶ç­‰ ,macroå®å±•å¼€ï¼Œå¤„ç†â€™#â€™å¼€å¤´æŒ‡ä»¤ å•åšé¢„å¤„ç†, å¹¶å–å¾—é¢„å¤„ç†ç»“æœ clang -E main.m é¢„å¤„ç†æœ€ç»ˆç»“æœï¼š 12345678910111213141516# 1 &quot;/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/Foundation.framework/Headers/FoundationLegacySwiftCompatibility.h&quot; 1 3# 185 &quot;/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/System/Library/Frameworks/Foundation.framework/Headers/Foundation.h&quot; 2 3# 2 &quot;main.m&quot; 2int main(){ @autoreleasepool { int eight = 8; int six = 6; NSString* site = [[NSString alloc] initWithUTF8String:&quot;starming&quot;]; int rank = eight + six; NSLog(@&quot;%@ rank %d&quot;, site, rank); } return 0;} ä¾æ®ä¸Šé¢çš„ç»“æœèƒ½æ˜æ˜¾çœ‹åˆ° headerè¢«æ¢æˆäº†æ˜ç¡®çš„å…¨å±€ä½ç½®ï¼Œå¸¸é‡DEFINEEightä¹Ÿè¢«æ›¿æ¢è¿›ä»£ç é‡Œï¼Œè®²åˆ°import å°±ä¸å¾—ä¸æ modules 2.1 Modules æ¨¡å— (-fmodules) å‚è€ƒ LLVM modulesæ–‡æ¡£ æ–‡ç« é‡ŒæåŠï¼šModules provide an alternative, simpler way to use software libraries that provides better compile-time scalability and eliminates many of the problems inherent to using the C preprocessor to access the API of a library. Clang ä»¥ç®€å•çš„ import std.io æ¦‚å¿µå–ä»£ åŸæœ¬å†—ä½™çš„å‡½æ•°åº“(libraries)å¼•è¿› #include &lt;stdio.h&gt;ï¼Œç±»ä¼¼javaçš„packageï¼Œç›®å‰Clang #includeçš„æœºåˆ¶æ˜¯ ç¼–è¯‘å™¨ä¼šå»é€’å›æ£€æŸ¥æ¯ä¸ªHeaderï¼Œheader inculdeçš„ headeræ–‡ç« é‡Œæäº†å‡ ä¸ªå¼±ç‚¹ï¼šCompile-time scalabilityï¼šè€—æ—¶ç¼–è¯‘Fragilityï¼šå¤šå¼•å…¥é¡ºåºæˆ–å¯¼è‡´å®å†²çªConventional workaroundsï¼šCè¯­è¨€é•¿ä¹…çš„æ¯æƒ¯ï¼Œå¯¼è‡´ä»£ç è¾ƒä¸‘ Tool confusion ç„¶è€Œç¼–è¯‘å™¨åœ¨ç¢°åˆ°importæ—¶ï¼Œä¼šç›´æ¥è½½å…¥moduleå¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å–å¾—ä»–çš„apiï¼Œä¸€ä¸ªmoduleä¸ä¾èµ–å¤–éƒ¨headerï¼Œåªç¼–è¯‘ä¸€æ¬¡ï¼Œapiä¹Ÿåªè§£æä¸€æ¬¡ï¼Œå½“ç„¶moduleä¹Ÿæœ‰äº›ç¼ºç‚¹åŒ…æ‹¬ namesspaceï¼ˆå¯èƒ½é‡åï¼‰, æ”¹åº“ä»£ç , æ— æ³•é€‚åº”å„ç§æœºå™¨çš„Archã€‚ 3 Lexical Analysis (è¯æ³•åˆ†æ Lex, Tokenization) -&gt; .i (Tokens)æ­¤æ­¥éª¤æ˜¯Compileré‡Œçš„åŸºæœ¬ç¨‹åºï¼Œå°†å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªçš„è¯»è¿›Lexeré‡Œï¼Œå¹¶æ ¹æ®æ„è¯è§„åˆ™è¯†åˆ« Token(å•è¯)ï¼Œæ­¤å¤„è¿˜ä¸ä¼šæ ¡éªŒè¯­æ³• åšè¯æ³•åˆ†æå¹¶æŠŠTokenåˆ†æç»“æœå±•ç¤ºå‡ºæ¥ clang -fmodules -fsyntax-only -Xclang -dump-tokens main.m æ¯ä¸€ä¸ªæ ‡è®°éƒ½åŒ…å«äº†å¯¹åº”çš„æºç å†…å®¹å’Œå…¶åœ¨æºç ä¸­çš„ä½ç½®ã€‚æ³¨æ„è¿™é‡Œçš„ä½ç½®æ˜¯å®å±•å¼€ä¹‹å‰çš„ä½ç½®ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œclang èƒ½å¤Ÿåœ¨æºç ä¸­æŒ‡å‡ºå‡ºé”™çš„å…·ä½“ä½ç½®ã€‚ -fsyntax-only: Run the preprocessor, parser and type checking stages. 4 è¯­æ³•åˆ†æ(Semantic Analysis) -&gt; ASTè¯­æ³•åˆ†æï¼Œåœ¨Clangä¸­æœ‰Parserå’ŒSemaä¸¤ä¸ªæ¨¡å—é…åˆå®Œæˆï¼ŒéªŒè¯è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œå¹¶ç»™å‡ºæ­£ç¡®çš„æç¤ºã€‚ 4.1 Parseréå†æ¯ä¸ªTokenåšè¯å¥åˆ†æï¼Œç”Ÿæˆä¸€ä¸ª èŠ‚ç‚¹ï¼ˆNodesï¼‰è¯¥æœ‰çš„èµ„è®¯ 4.2 Semanticåœ¨Lex è·Ÿ syntax Analysisä¹‹å\b, ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå·²ç»ç¡®ä¿ è¯ å¥ è¯­æ³•å·²ç»æ˜¯æ­£ç¡®çš„å½¢å¼äº†ï¼Œ\bsemantic æ¥ç€åšreturn values, size boundaries, uninitialized variables ç­‰æ£€æŸ¥ï¼Œä¹‹åæ ¹æ®å½“å‰çš„èµ„è®¯ï¼Œç”Ÿæˆè¯­æ„èŠ‚ç‚¹ï¼ˆNodesï¼‰ï¼Œå¹¶å°†æ‰€æœ‰èŠ‚ç‚¹ç»„åˆæˆæŠ½è±¡è¯­æ³•ä¹¦(AST) åš è¯­æ³•åˆ†æ å¹¶å±•ç¤º AST clang -fmodules -fsyntax-only -Xclang -ast-dump main.m 5 æŠ½è±¡è¯­æ³•æ ‘ Abstract Syntax Treeå¯ä»¥è¯´æ˜¯Clangçš„æ ¸å¿ƒï¼Œå¤§éƒ¨åˆ†çš„ä¼˜åŒ–, åˆ¤æ–­éƒ½åœ¨ASTå¤„ç†ï¼ˆä¾‹å¦‚å¯»æ‰¾Class, æ›¿æ¢ä»£ç â€¦ç­‰) æ­¤æ­¥éª¤ä¼šå°† Clang Attr è½¬æ¢æˆ AST ä¸Šçš„ AttributeListï¼Œèƒ½åœ¨clangæ’ä»¶ä¸Šé€è¿‡ Decl::getAttr&lt;T&gt; è·å– Clang Attributes æ˜¯ Clang æä¾›çš„ä¸€ç§æºç æ³¨è§£ï¼Œæ–¹ä¾¿å¼€å‘è€…å‘ç¼–è¯‘å™¨è¡¨è¾¾æŸç§è¦æ±‚ï¼Œå‚ä¸æ§åˆ¶å¦‚ Static Analyzerã€Name Manglingã€Code Generation ç­‰è¿‡ç¨‹, ä¸€èˆ¬ä»¥ __attribute__(xxx) çš„å½¢å¼å‡ºç°åœ¨ä»£ç ä¸­, Ex: NS_CLASS_AVAILABLE_IOS(9_0) ç»“æ„è·Ÿå…¶ä»–Compilerçš„ASTç›¸åŒä¸å…¶ä»–ç¼–è¯‘å™¨ä¸åŒçš„æ˜¯ Clangçš„ASTæ˜¯ç”±C++æ„æˆç±»ä¼¼Class,Variableçš„å±‚çº§è¡¨ç¤ºï¼Œå…¶ä»–çš„åˆ™æ˜¯ä»¥æ±‡ç¼–è¯­è¨€ç¼–å†™ã€‚ è¿™ä»£è¡¨ç€ASTä¹Ÿèƒ½æœ‰å¯¹åº”çš„apiï¼Œè¿™è®©ASTæ“ä½œ, è·å–ä¿¡æ¯ éƒ½æ¯”è¾ƒå®¹æ˜“ï¼Œç”šè‡³è¿˜å¤¹å¸¦ç€åœ°å€è·Ÿä»£ç ä½ç½®ã€‚ AST Context: å­˜å‚¨æ‰€æœ‰ASTç›¸å…³èµ„è®¯, ä¸”æä¾›ASTMatcherç­‰éå†æ–¹æ³• Nodeä¸‰å¤§Class Decl - Declarations(å£°æ˜), Stmt - Statements(é™ˆè¿°å¥), type(ç±»å‹) å­ç±»è¿‡äºè¯¦ç»†ä¸åœ¨è¿™å¤šå†™ 6 ä»£ç ç”Ÿæˆ CodeGen -&gt; IRä¸­é—´ä»£ç (.ll)CodeGenè´Ÿè´£å°†è¯­æ³•æ ‘ä»é¡¶è‡³ä¸‹éå†ï¼Œç¿»è¯‘æˆLLVM IRï¼Œæ˜¯LLVM Backend çš„è¾“å…¥ï¼Œæ˜¯å‰åç«¯çš„æ¡¥æ¥è¯­è¨€ã€‚ äº§å‡ºIR: clang -S -fobjc-arc -emit-llvm main.m -o main.ll LLVM IR æœ‰ä¸‰ç§è¡¨ç¤ºæ ¼å¼ï¼Œç¬¬ä¸€ç§æ˜¯ bitcode è¿™æ ·çš„å­˜å‚¨æ ¼å¼ï¼Œä»¥ .bc åšåç¼€ï¼Œç¬¬äºŒç§æ˜¯å¯è¯»çš„ä»¥ .llï¼Œç¬¬ä¸‰ç§æ˜¯ç”¨äºå¼€å‘æ—¶æ“ä½œ LLVM IR çš„å†…å­˜æ ¼å¼ã€‚ äº§å‡ºBit clang -emit-llvm -c main.m -o main.bc æŸ¥çœ‹BitCode llvm-dis &lt; main.bc | less 6.1 IR ä¼˜åŒ– OptimizationIRæä¾›äº†å¤šç§ä¼˜åŒ–é€‰é¡¹ï¼Œ-01 -02 -03 -0sâ€¦. å¯¹åº”ç€ä¸åŒçš„å…¥å‚ï¼Œæœ‰æ¯”å¦‚ç±»ä¼¼æ­»ä»£ç æ¸…ç†ï¼Œå†…è”åŒ–ï¼Œè¡¨è¾¾å¼é‡ç»„ï¼Œå¾ªç¯å˜é‡ç§»åŠ¨è¿™æ ·çš„ Passã€‚ Extra: Clang æ’ä»¶ä½¿ç”¨ libclan g, clang, LibTooling æ’ä»¶å¯ä»¥æ”¹å˜ clang ç”Ÿæˆä»£ç çš„æ–¹å¼ï¼Œå¢åŠ æ›´å¼ºçš„ç±»å‹æ£€æŸ¥ï¼Œæˆ–è€…æŒ‰ç…§è‡ªå·±çš„å®šä¹‰è¿›è¡Œä»£ç çš„æ£€æŸ¥åˆ†æç­‰ç­‰ã€‚è¦æƒ³è¾¾æˆä»¥ä¸Šçš„ç›®æ ‡ï¼Œ reference: Clangæ’ä»¶äº†è§£Clang-astUnderstanding the Clang ASTAST DetailClangASThttps://clang.llvm.org/# æ·±å…¥å‰–æ-iOS-ç¼–è¯‘-Clanghttps://llvm.org/devmtg/2017-06/2-Hal-Finkel-LLVM-2017.pdf# ä»Swiftæ¡¥æ¥æ–‡ä»¶åˆ°Clang-LLVM","link":"/blog/2018/11/19/Clang/"},{"title":"å¦‚ä½•å®ä½œåŸç”ŸIOSçƒ­åº¦å›¾-CGç›´æ¥åšå›¾+MapKit","text":"æœ¬æ•™ç¨‹ä½¿ç”¨Swift 3.1, Xcode 8.0 ä»£ç :https://github.com/jamesdouble/JDSwiftHeatMap ç°åœ¨Iphoneä½¿ç”¨è€…å¸¸ä½¿ç”¨çš„åœ°å›¾æ’ä»¶ï¼Œä¸å¤–ä¹å°±æ˜¯é«˜å¾·ä¸ç™¾åº¦ï¼Œå›½å¤–åˆ™æ˜¯Googleï¼Œçœ‹æ¥çœ‹å»å°±æ˜¯æ²¡å•¥äººåœ¨ç”¨æœ¬åœ°ç«¯è‡ªå¸¦çš„MKMapViewï¼Œä¸€ä¸ªåŸå› æ˜¯èµ·æ­¥æ™šæ‰€ä»¥æ¬ ç¼ºå¾ˆå¤šä½¿ç”¨è€…ç»éªŒè·Ÿèµ„æ–™ï¼Œå†æ¥ä¸€ä¸ªæˆ‘è‡ªå·±è®¤ä¸ºæ˜¯ç°æˆAPIæå°‘ï¼ŒMKMapViewåŸºæœ¬ä¸Šåªæœ‰Annotaion,Overlayæ˜¯Developerå¯ä»¥è‡ªè®¢çš„ï¼Œè€Œç™¾åº¦æœ‰è½¨è¿¹,é›·è¾¾â€¦ç­‰å·²ç»æ˜¯ç°æˆçš„APIã€‚ äºæ˜¯æˆ‘è¶Šæƒ³è¶Šä¸é¡ºå¿ƒï¼Œè¦ç”¨è¿˜æ˜¯è¦ç”¨å’±IOSåŸç”Ÿè‡ªå¸¦çš„ï¼Œåœ¨ç½‘ä¸Šæœäº†ä¸€åœˆåªçœ‹åˆ°ä¸€ä¸ªç”¨OCå†™çš„å¤è€é¡¹ç›®ï¼Œç”¨èµ·æ¥æ€»ä¸é¡ºå¿ƒï¼Œç°åœ¨æƒ³ç»ç”±å¼€æºçš„æ–¹æ³•æ±‡æ•´å¤§å®¶æ„è§æ¥æé«˜æ•´ä½“çš„è‡ªç”±åº¦è·Ÿä½¿ç”¨æ€§ã€‚ çƒ­åº¦å›¾çƒ­åº¦å›¾æ˜¯æ—©æœŸ(1991)å°±å·²ç»å‡ºç°çš„èµ„æ–™è¡¨è¾¾å½¢å¼(çŸ©é˜µè¡¨ç¤º)ï¼Œå…¶æˆç†Ÿåº¦ä»¥åŠç›¸å¯¹åº”è¡ç”Ÿå›¾åƒä¹Ÿæ˜¯ç›¸å¯¹äºå…¶ä»–çš„åœ°å›¾è¡¨è¾¾æ–¹å¼æˆç†Ÿã€‚ å‰è¨€å®ä½œèµ·æ¥ä¸éœ€è¦ç”¨å¤ªå¹¿çš„çŸ¥è¯†æˆ–æ˜¯ä»€ä¹ˆæ·±ä¸è§åº•çš„æŠ€æœ¯ï¼ŒåŸºæœ¬ä¸Šåªè¦ç†Ÿæ‚‰ä¸¤ä¸ªåŒºå—ï¼š MapKit : è¿™ä¸ªå½“ç„¶æ˜¯å¿…é¡»çš„ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯è¦å»ºç«‹åœ¨åŸç”Ÿçš„åœ°å›¾ä¸Šï¼Œä½†åŸºæœ¬çš„å¦‚ä½•æ–°å¢Overlay,OverlayRenderâ€¦ç­‰ï¼Œè¿™ç¯‡æ–‡ç« ä¸ä¼šåšå¤ªå¤šè§£é‡Šã€‚ CGContext : ä¹Ÿå°±æ˜¯æŒ‡Core Graphic, è¿™å—åº”è¯¥æ˜¯ä¸ç®¡èµ°åˆ°å“ªéƒ½ä¼šç¢°åˆ°çš„å†¤å®¶ï¼Œä¸å¤–ä¹å°±æ˜¯æ¶‚é¸¦ç€è‰²å•¦ï½ ä½¿ç”¨è€…Inputåˆ©ç”¨Delegateå–å¾—èµ„æ–™ç‚¹çš„ç»çº¬åº¦ã€å½±å“èŒƒå›´è·Ÿå½±å“åŠ›ã€‚ HeatMap on MapKit - è®°å½•ä½ç½®MapKitè¯¥åšçš„å°±æ˜¯MapKitâ€œèƒ½â€åšçš„ï¼Œè®°å½•ç›¸å…³çš„åœ°ç†èµ„æ–™ï¼ŒåŒ…æ‹¬èµ„æ–™çš„â€œç»çº¬åº¦åº§æ ‡â€œä»¥åŠè·ç¦»ã€‚ MKOVeraly:å¾ˆæ˜æ˜¾ï¼Œçƒ­åº¦å›¾è¿™æ ·è¶…çº§ä¸è§„åˆ™çš„å›¾å½¢ï¼ŒMKCircle,MKPolyline,MKPolygonâ€¦ç­‰ï¼Œå¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬éœ€è¦çš„ï¼Œè¿˜æ˜¯å¾—ä»æœ€æ ¹æœ¬çš„MKOverlayé‡æ–°åˆ›é€ ä¸€ä¸ªå­ç±»åˆ«ã€‚ è®¡ç®—Overlayçš„BoudingMapRect(æ¶µç›–èŒƒå›´)ï¼š 1234567891011121314151617181920212223242526/** æœ‰æ–°çš„ç‚¹åŠ è¿›æ¥ -&gt; é‡æ–°è®¡ç®—è¿™ä¸ªOverlayçš„æ¶µç›– */ override func caculateMaprect(newPoint:JDHeatPoint){ var MaxX:Double = -9999999999999 var MaxY:Double = -9999999999999 var MinX:Double = 99999999999999 var MinY:Double = 99999999999999 if let BeenCaculatedMapRect = CaculatedMapRect{ //éé¦–æ¬¡è®¡ç®— -&gt; æŠŠä¸Šæ¬¡è®¡ç®—çš„MapRectæ‹¿å‡ºæ¥ï¼Œæ¯”MaxX,Y MinX,Y MaxX = MKMapRectGetMaxX(BeenCaculatedMapRect) let heatmaprect = newPoint.MapRect let tMaxX = MKMapRectGetMaxX(heatmaprect) MaxX = (tMaxX &gt; MaxX) ? tMaxX : MaxX . . //æ¯æ¬¡è®¡ç®—æ–°çš„èµ„æ–™ç‚¹ï¼ŒMapRectéƒ½ä¼šå˜å¤§ã€‚} else{ //é¦–æ¬¡è®¡ç®— -&gt; å–ç¬¬ä¸€ä¸ªç‚¹çš„Maprecr let heatmaprect = newPoint.MapRect . . } let rect = MKMapRectMake(MinX, MinY, MaxX - MinX, MaxY - MinY) self.CaculatedMapRect = rect } åŒç†ï¼Œç°æœ‰çš„OverlayRenderéƒ½æ— æ³•æ»¡è¶³ï¼Œæˆ‘ä»¬è¦çš„å½¢çŠ¶ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯é‡æ–°å®šä¹‰ä¸€ä¸ªç±»åˆ«ã€‚ drawæ˜¯è¿™ä¸ªç±»æœ€é‡è¦çš„Funcï¼Œå†ä¹‹åCore Graphic é‚£æ®µä¸€èµ·å†™ã€‚ 1override func draw(_ mapRect: MKMapRect, zoomScale: MKZoomScale, in context: CGContext) è¿‡æ¸¡(ï¼­apKit -&gt; Core Graphic)ç†Ÿæ‚‰MapKitçš„æœ‹å‹ä»¬ä¸€å®šéƒ½çŸ¥é“ï¼ŒMKMapRectä¸CGRectçš„å·®åˆ«ï¼Œä¹Ÿæ¸…æ¥šä»–çš„è½¬æ¢æ–¹æ³•ï¼Œé€šå¸¸åªä¼šåœ¨ä¸Šè¿°çš„**â€ draw â€œï¼Œä¹Ÿå°±æ˜¯è¦ç”»çš„æ—¶å€™è¿›è¡Œè½¬æ¢ï¼Œä½†æˆ‘è¿™è¾¹å¿…é¡»ææ—©è¿›è¡Œï¼Œå› ä¸ºæˆ‘å¿…é¡»å…ˆçŸ¥é“æˆ‘è¦ç”»ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œè‡ªå¸¦ä¸€ä¸ªåè¯*[ RowFormData ]***ã€‚ ä½¿ç”¨è€…èµ„æ–™ä¸›é›†è½¬æ¢å‰ï¼š å•ä½:MKMapRect,ä½ç½®:MKMapPoint,èŒƒå›´:KilloMeter,åŸç‚¹:å¾ˆå¤§ ä½¿ç”¨è€…èµ„æ–™è½¬æ¢åï¼š å•ä½:CGRect,ä½ç½®:CGPoint,èŒƒå›´:CGFloat,åŸç‚¹:(0,0) 1234567891011121314151617181920212223242526//JDOverlayRender override func caculateRowFormData(maxHeat level:Int)-&gt;(data:[RowFormHeatData],rect:CGRect)? { var rowformArr:[RowFormHeatData] = [] // for heatpoint in overlay.HeatPointsArray { //å°†æ•´ä¸ªä¸›é›†è½¬æ¢æˆCGRect let mkmappoint = heatpoint.MidMapPoint let GlobalCGpoint:CGPoint = self.point(for: mkmappoint) let OverlayCGRect = rect(for: overlay.boundingMapRect) //å°†åŸç‚¹åŒ–æˆ(0,0) let localX = GlobalCGpoint.x - (OverlayCGRect.origin.x) let localY = GlobalCGpoint.y - (OverlayCGRect.origin.y) let loaclCGPoint = CGPoint(x: localX, y: localY) //å°†åŠå¾„è½¬ä¹˜CGFloat let radiusinMKDistanse:Double = heatpoint.radiusInMKDistance let radiusmaprect = MKMapRect(origin: MKMapPoint.init(), size: MKMapSize(width: radiusinMKDistanse, height: radiusinMKDistanse)) let radiusCGDistance = rect(for: radiusmaprect).width //å‚¨å­˜æ–°çš„èµ„æ–™é›† let newRow:RowFormHeatData = RowFormHeatData(heatlevel: Float(heatpoint.HeatLevel) / Float(level), localCGpoint: loaclCGPoint, radius: radiusCGDistance) rowformArr.append(newRow) } let cgsize = rect(for: overlay.boundingMapRect) return (rect:cgsize,data:rowformArr) } è®¡ç®—å±‚ï¼šå°†RowFormData-&gt;CGImageæˆ‘ä»¬æœ‰äº†RowFormDataåï¼Œå°±èƒ½å¼€å§‹è®¡ç®—ä»€ä¹ˆä½ç½®æ”¾ä»€ä¹ˆé¢œè‰²ï¼Œæˆ‘ä»¬è¿™é‡Œè‡ªåˆ›ä¸€ä¸ªç®€æ˜“çš„ç±»åˆ«ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åŒºéš”è¯¥åšçš„äº‹ï¼š è¿™è¾¹ä¼šç”¨åˆ°çš„Core Graphicå¹¶ä¸æ˜¯ä¸€èˆ¬å¸¸è§çš„UIGraphicsBeginImageContextä¹‹åï¼ŒGetContextåœ¨åšmovePoint,addArc,addPathâ€¦.ç­‰ï¼Œå› ä¸ºè¦å†æ¬¡å¼ºè°ƒæˆ‘ä»¬å›¾å±‚çš„å½¢çŠ¶æ˜¯è¶…çº§ä¸è§„åˆ™ï¼Œç”šè‡³è¿˜è¦è®¡ç®—é¢œè‰²ã€‚ è¶…çº§è¸©å‘åŒºè¶…çº§è¸©å‘åŒºè¶…çº§è¸©å‘åŒºæˆ‘ä»¬è¦ç”¨çš„æ˜¯CGContexé‡Œçš„å»ºæ„å¼ å‚æ•°æœ‰data,width,height,bitsPerComponent,bytesPerRow,space,bitmapInfoè¯¥æ€ä¹ˆçœ‹å‘¢ï¼Ÿï¼ˆå¯¹äºå›¾ç‰‡æ¦‚å¿µä¸ç†Ÿæ‚‰çš„æœ‹å‹ï¼Œæˆ‘åœ¨è¿™ä¹Ÿæ‰¯ä¸å®Œï¼Œç½‘ä¸Šæœç´¢Bitmapæˆ–Pixelsè¿˜æœ‰RGBåº”è¯¥å°±å¾ˆå¤šäº†ã€‚ï¼‰ å‚æ•°åªè¦é…å¯¹é”™è¯¯å°±ä¼šæŠ¥é”™ï¼Œè€Œä¸”ä¸ä¼šè·Ÿä½ è¯´é”™å“ª ä¸Šå›¾çš„width,heightå·²ç»æœ‰äº†ï¼Œå°±æ˜¯åˆšåˆšè®¡ç®—å‡ºæ¥çš„CGRect CGColorSpace &amp; BitmapInfoï¼šè¿™ä¸¤ä¸ªå‚æ•°ç›¸è¾…ç›¸æˆï¼Œå°±æ˜¯å‘Šè¯‰å®ƒä½ çš„dataä¼šä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å‘ˆç°ï¼Œä»¥RGBæˆ–æ˜¯ç°é˜¶â€¦ç­‰ï¼Œä¸Šé¢çš„å›¾ç‰‡æ˜¯RGBï¼Œæˆ‘ä»¬è¦ç”¨çš„ä¹Ÿæ˜¯RGB***ï¼ˆspace = CGColorSpaceCreateDeviceRGB())***ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªå€¼Alphaè¿™ä¸ªå€¼å¤§å®¶ï¼ŒbitmapInfo = CGImageAlphaInfo.premultipliedLast.rawValue,è¿™å‘Šè¯‰å®ƒalphaç›´æ”¾åœ¨æœ€å â€“&gt; ä¹Ÿå°±æ˜¯ä¸€ä¸ªPixelæ ¼å¼ï¼ˆR G B A) æœ‰äº†Pixelæ ¼å¼å°±çŸ¥é“å®ƒçš„å¤§å°ï¼Œå››ä¸ªå€¼éƒ½æ˜¯0~255æ‰€ä»¥æ˜¯8ä¸ªBitsï¼ˆBitsPerComponentï¼‰ï¼Œä¸€ä¸ªPixelå°±æ˜¯8 * 4 =32Bits (4Bytes)ï¼ŒbytesPerRow = 4 * widthã€‚ å¾—çŸ¥Dataæ ¼å¼æ˜¯å¤§å° (4 x width) x heightçš„ UTF8Char(å¤§å°åˆšå¥½æ˜¯8bits)é˜µåˆ—ã€‚ å›åˆ°ä»£ç ï¼š 123456789101112131415161718192021222324252627282930override func produceRowData() { var ByteCount:Int = 0 for h in 0..&lt;self.FitnessIntSize.height { for w in 0..&lt;self.FitnessIntSize.width { var destiny:Float = 0 for heatpoint in self.rowformdatas { let pixelCGPoint = CGPoint(x: w, y: h) //è®¡ç®—æ¯ä¸ªèµ„æ–™ç‚¹å¯¹è¿™ä¸ªpixelçš„å¯†åº¦å½±å“ } . . let rgb = JDRowDataProducer.theColorMixer.getDestinyColorRGB(inDestiny: destiny) let redRow:UTF8Char = rgb.redRow let greenRow:UTF8Char = rgb.greenRow let BlueRow:UTF8Char = rgb.BlueRow let alpha:UTF8Char = rgb.alpha //å­˜å…¥4ä¸ªByteè¿›RowData self.RowData[ByteCount] = redRow self.RowData[ByteCount+1] = greenRow self.RowData[ByteCount+2] = BlueRow self.RowData[ByteCount+3] = alpha ByteCount += 4 } } } æœ‰äº†Dataå›åˆ°Render123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354override func draw(_ mapRect: MKMapRect, zoomScale: MKZoomScale, in context: CGContext) { func getHeatMapContextImage()-&gt;CGImage? { //More Detail func CreateContextOldWay()-&gt;CGImage? { func heatMapCGImage()-&gt;CGImage? { let tempBuffer = malloc(BitmapMemorySize) memcpy(tempBuffer, &amp;dataReference, BytesPerRow * Bitmapsize.height) defer { free(tempBuffer) } let rgbColorSpace:CGColorSpace = CGColorSpaceCreateDeviceRGB() let alphabitmapinfo = CGImageAlphaInfo.premultipliedLast.rawValue if let contextlayer:CGContext = CGContext(data: tempBuffer, width: Bitmapsize.width, height: Bitmapsize.height, bitsPerComponent: 8, bytesPerRow: BytesPerRow, space: rgbColorSpace, bitmapInfo: alphabitmapinfo) { return contextlayer.makeImage() } return nil } if let cgimage = heatMapCGImage() { let cgsize:CGSize = CGSize(width: Bitmapsize.width, height: Bitmapsize.height) UIGraphicsBeginImageContext(cgsize) if let contexts = UIGraphicsGetCurrentContext() { let rect = CGRect(origin: CGPoint.zero, size: cgsize) contexts.draw(cgimage, in: rect) return contexts.makeImage() } } print(&quot;Create fail&quot;) return nil } let img = CreateContextOldWay() UIGraphicsEndImageContext() return img } if let tempimage = getHeatMapContextImage() { let mapCGRect = rect(for: overlay.boundingMapRect) Lastimage = tempimage context.clear(mapCGRect) self.dataReference.removeAll() context.draw(Lastimage!, in: mapCGRect) } else{ print(&quot;cgcontext error&quot;) } } å†™åˆ°æœ€åå‘ç°è‡ªå·±çš„æ¼”ç®—æ³•æœ‰ç‚¹å‡Œä¹±ï¼Œå†™è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯å¸Œæœ›èƒ½æœ‰äººèƒ½å‚ä¸è¿™ä¸ªreopï¼Œæ”¹è¿›æ•´ä¸ªæ•ˆèƒ½ï¼Œæ•´ä¸ªè¿‡ç¨‹æµ“ç¼©å°±æ˜¯ MKOverlay -&gt; CGImageã€‚","link":"/blog/2017/07/15/HeatMap/"},{"title":"SpriteKit - å¯¦åšè™›æ“¬æ–æ¡¿","text":"æœ¬æ–‡é€‚åˆSpriteKitåˆå¿ƒè€… æºç ï¼šhttps://github.com/jamesdouble/JDGamePaddle è™šæ‹Ÿæ‘‡æ†16å¹´ï¼ŒMOBAæ‰‹æ¸¸å¸‚åœºæ‰“å¾—å¯ç«çƒ­ï¼ˆè¿™é‡Œå’±ä¸å¸®ä»»ä½•æ¸¸æˆèƒŒä¹¦ï¼‰ï¼Œæ’¸ç‘Ÿå¦‚æˆ‘ä¹Ÿæ˜¯åœ¨16å¹´å¼€å§‹ç©SpriteKitï¼Œä¹Ÿå°±æ˜¯è‹¹æœè‡ªåˆ¶çš„2Dæ¸¸æˆæ¡†æ¶ã€‚æœ‰ç©è¿‡MOBAæ‰‹æ¸¸çš„ï¼Œä¸€å®šååˆ†ç†Ÿæ‚‰æ¸¸æˆé‡Œæˆ‘ä»¬æ˜¯å¦‚ä½•ç§»åŠ¨ä¸»äººå…¬çš„å§ï¼Ÿæ²¡ç©è¿‡çš„â€¦â€¦å’±ä»¬ä¸å•°å”†ï¼Œå…ˆä¸Šå›¾ã€‚ è¿™æ ·æƒ³ä¸èµ·æ¥çš„ä¹Ÿæƒ³èµ·æ¥äº†å‘—ï¼Œå› ä¸ºSpriteKitæœ¬èº«å¹¶æ²¡æœ‰æä¾›åƒæ‘‡æ†è¿™æ ·å…ƒä»¶(æœ‰æä¾›åè€Œå¥‡æ€ª)ï¼Œä¸ºäº†ä»¥é˜²æœ‹å‹ä»¬é‡‡å‘(ä¹Ÿæ²¡æœ‰å¾ˆå¤šå‘)ï¼Œæˆ‘å°±å†™äº†ä¸€ä¸ªç®€æ˜“çš„æ‘‡æ†Libï¼ŒSKScene,SKView(SpriteKitçš„UIView), UIViewçš†å¯ç›´æ¥åŠ ä¸Šã€‚ ç®€å•çš„å‡ºå‘ä¸€å¼€å§‹è‹¥æŠŠé—®é¢˜æƒ³å¾—å¤ªå¤æ‚ï¼Œé‚£æ­ªè·¯è‚¯å®šä¼šèµ°çš„ç‰¹åˆ«çš„å¤šï¼Œæˆ‘ä»¬å°±ç…§ç€ä¸Šé¢çš„å›¾æ¥åˆ»å§ï¼Œå¤–é¢ä¸€ä¸ªåœ†åœˆï¼Œå—¯ï¼Œé‡Œé¢ä¸€ä¸ªå°åœ†â€¦..å¥½ï¼Œç»“æŸäº† ï¼Œå°±ä»æ‹‰å‡ºä¸¤ä¸ªåœ†æ¥å‡ºå‘å§ï¼ï¼ ç»„ä»¶1:SKShapeNodeFor SpriteKitåˆå¿ƒè€…ï¼šUIKité‡Œæ¯ä¸ªå…ƒä»¶å‡ ä¹éƒ½æ˜¯UIViewçš„å­ç±»åˆ«ï¼Œè€ŒSpriteKité‡Œçš„æ¯ä¸ªå…ƒä»¶å‡ ä¹éƒ½æ˜¯SKNodeçš„å­ç±»åˆ«ã€‚ é‚£SKShapeNodeåˆæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯SKNodeçš„å­ç±»åˆ«ï¼Œè‹¥æ˜¯ä½ ä¸æ˜¯è¦ç”¨å›¾ç‰‡æ¥åˆå§‹åŒ–ä¸€ä¸ªç‰©ä»¶è€Œæ˜¯çº¯å‡ ä½•å½¢çŠ¶æˆ–æ˜¯çº¿æ¡çš„è¯ï¼Œä½¿ç”¨å®ƒæ¥åšNodeä¼šå¿«ä¸Šè®¸å¤šï¼Œçœ‹å®ƒçš„å»ºæ„å€¼å°±èƒ½çŸ¥é“ï¼ŒçœŸçš„å¾ˆâ€œå‡ ä½•â€ã€‚ æ¥å§ï¼ç¬¬ä¸€æ­¥ï¼ä¸¤ä¸ªåœ†å½¢ï¼ 12345MovingPing = SKShapeNode(circleOfRadius: paddleSize.width * 0.18)MovingPing?.fillColor = UIColor.black //å†…åœ†é»‘è‰²å®å¿ƒPaddleBorder = SKShapeNode(circleOfRadius: paddleSize.width * 0.5 )PaddleBorder?.fillColor = UIColor.clear //å¤–åœ†ä¸­é—´ç©ºå¿ƒPaddleBorder?.strokeColor = UIColor.black ç»„ä»¶2ï¼šç‚¹å‡»ã€æ»‘åŠ¨Hmmâ€¦. We almost here, right? ä¸è¿‡ç°åœ¨ä½ ä¸ç®¡æ€ä¹ˆæ‹¨å¼„å®ƒï¼Œå®ƒéƒ½ä¸ä¼šç§»åŠ¨çš„ï¼Œåœ¨SpriteKité‡Œå¸¸åšçš„å¤„ç†ç‚¹å‡»æ–¹å¼æ˜¯å®ä½œè¦†å†™UIResponderå¤§å®¶å¸¸è§çš„Methodã€‚ 1234567891011121314151617181920212223override func touchesBegan(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) { let touch = touches.first! touching = true let position = touch.location(in: self) if((PaddleBorder!.contains(position))) //è‹¥æ˜¯æ‰‹æŒ‡è¿˜åœ¨è¾¹ç•Œå†… { MovingPing?.position = touch.location(in: self) //å†…åœ†ç§»åˆ°æ‰‹æŒ‡ä½ç½® } didMove() } override func touchesMoved(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) { let touch = touches.first! let postion = touch.location(in: self) if((PaddleBorder!.contains(postion))) { MovingPing?.position = postion } /* ç•¥ */ } ç»“æŸäº†å—ï¼Ÿæ‰§è¡Œèµ·æ¥è¯•è¯•å§ã€‚çœ‹èµ·æ¥å¬ç”Ÿç¡¬çš„å¯¹å§ï¼Œè‹¥æ˜¯æœ‰MOBAæ‰‹æ¸¸åªåšåˆ°è¿™è¾¹ï¼Œä¸»äººå…¬ä¸€å®šæ˜¯è„šæŠ½äº†ç­‹ã€‚ä¼šå‘ç”Ÿè¿™æ ·çš„æ¯å…·æ˜¯åœ¨touchesMovedåªåˆ¤æ–­æ˜¯å¦æ‰‹æŒ‡åœ¨å¤–åœˆå†…ï¼Œè€Œå¿½ç•¥äº†è‹¥æ˜¯ä½¿ç”¨è€…ä»å†…åœˆæ»‘åˆ°å¤–åœˆçš„æƒ…å†µã€‚ è®©æˆ‘ä»¬æŠŠä¸Šé¢é‚£æ®µæ³¨è§£æ¢æˆ 1234567891011121314151617 else{ movingpaddleSmoothly(position: postion) }//ç®—å‡ºè¾¹ç•Œå¤–æ‰‹æŒ‡è·Ÿä¸­å¿ƒè¿æˆä¸€çº¿åï¼Œè·Ÿè¾¹ç•Œçš„äº¤ç‚¹ã€‚ func movingpaddleSmoothly(position:CGPoint) { let centerPoint = PaddleBorder!.position let radius = self.frame.width * 0.5 var distance:CGFloat = 0 let diffx:CGFloat = (centerPoint.x - position.x) * (centerPoint.x - position.x) let diffy:CGFloat = (centerPoint.y - position.y) * (centerPoint.y - position.y) distance = sqrt(diffx + diffy) let ratio:CGFloat = radius/distance let newPostition:CGPoint = CGPoint(x: position.x * ratio, y: position.y * ratio) MovingPing?.position = newPostition } æœ€åæˆ‘ä»¬å†æ¯æ¬¡ç§»åŠ¨æ‘‡æ†æ—¶ï¼Œå›ä¼ ä¸€ä¸ªç»è¿‡æ­£è§„åŒ–çš„CGVectorå‡ºå»ç»™å§”ä»»ï¼Œä»¥ä¾¿ä½¿ç”¨è€…èƒ½éšç€æ»‘åŠ¨æ‘‡æ†ï¼Œåšå‡ºé€‚å½“çš„å›åº”ã€‚","link":"/blog/2017/01/06/SpriteKit_GamePaddle/"},{"title":"å¦‚ä½•åˆ»å‡ºä¸€ä¸ªå¯æ‹–åŠ¨çš„å¯¼èˆªæµ®å‹•æŒ‰é’®","text":"æœ¬ç¯‡æ•™ç¨‹ä½¿ç”¨Swift æºç¢¼:https://github.com/jamesdouble/JDJellyButtonï¼Œä»¥ä¸‹ç¨±JDJellyButton 0)ä½•è¬‚å°èˆªæµ®å‹•æŒ‰éˆ• å½“ä½ çš„åº”ç”¨å¼€å‘åˆ°ä¸€å®šç¨‹åº¦çš„è§„æ¨¡æ—¶ï¼Œå¿…é¡»è¦æœ‰ä¸ªååˆ†æ¸…æ™°æ˜äº†çš„å¯¼èˆªåŠŸèƒ½ï¼Œæ‰ä¸ä¼šè®©ä½¿ç”¨è€…å¡åœ¨æŸä¸€é¡µï¼Œä¸çŸ¥é“å¦‚ä½•å‰å¾€ä»–ä»¬æƒ³å»çš„é¡µé¢ã€‚å¸¸è§çš„å¯¼èˆªæ–¹å¼ï¼Œä¸å¤–ä¹æœ€å¸¸ç”¨UITabBarControllerã€UINavigationBarï¼Œå¦å¤–æœ‰ä¸€ç§è™½ç„¶å¸¸è§ï¼Œä½†æ˜¯å› ä¸ºä¸æ˜¯IOSåŸç”Ÿå°±æœ‰çš„UIControlï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒå°‘äººä½¿ç”¨ï¼Œé‚£å°±æ˜¯ â€œfloating navigation buttonâ€œã€‚ä¹‹æ‰€ä»¥ä¼šæœ‰**â€™Floatingâ€™**è¿™ä¸ªå­—çœ¼ï¼Œæ˜¯å¤§å¤šè¿™æ ·çš„å¯¼èˆªæŒ‰é’®ä¼šå‡Œé©¾åœ¨æ‰€æœ‰è§†å›¾æ§åˆ¶å™¨(UIâ€¦ViewController)ä¸Šï¼Œä¸ç®¡åº•ä¸‹çš„è§†å›¾æ§åˆ¶å™¨å¦‚ä½•åˆ‡é¡µä»–éƒ½ä¼šä¿æŒåœ¨åŒæ ·çš„ä½ç½®ã€‚ 0.1)JDJellyButtonç‰¹è‰²ï¼šæŒ‰éˆ•ç¾¤çµ„æºç¢¼å…¶ä¸­ä¸€å€‹ç‰¹è‰²å°±æ˜¯æµ®å‹•æŒ‰éˆ•é™„æœ‰ç¾¤çµ„çš„åŠŸèƒ½ï¼Œèƒ½è®“ä¸€å€‹æµ®å‹•æŒ‰éˆ•èƒ½åŒ…å«æ›´å¤šçš„å­æŒ‰éˆ•ä»¥è™•ç†æ›´å¤šä¸åŒçš„äº‹ä»¶ã€‚ 0.2)UIView or UIButton?å¤§éƒ¨åˆ†çš„æŒ‰é’®æ§ä»¶è™½ç„¶éƒ½æ˜¯â€˜æŒ‰é’®â€™ï¼Œä½†æ˜¯æ¯”èµ·ç»§æ‰¿å®ä½œUIButton,è¿˜ä¸å¦‚ç»§æ‰¿å®ä½œä»–çš„çˆ¶ç±»åˆ«UIView, å¯åšçš„äº‹æ¯”è¾ƒå¤šï¼Œé™åˆ¶ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæœ¬æ–‡çš„JDJellyButtonç»§æ‰¿è‡ªUIViewã€‚ 0.3)Gesturer or UIResponderå› ä¸ºæˆ‘ä»¬æ˜¯è‡ªå·±å®ä½œç»§æ‰¿UIViewçš„ç±»åˆ«ï¼Œæ¯”èµ·æ¯ä¸ªæŒ‰é’®éƒ½è¦åŠ ä¸Šæ‰‹åŠ¿ï¼Œæˆ‘æ¯”è¾ƒåå¥½åœ¨ç±»åˆ«ä¸‹å®ä½œå‡ ä¸ªå¸¸è§çš„UIResponderæ–¹æ³• - touchesBegan, touchesMovedã€‚ä¸€æ¥çœå»è¿˜è¦å®£å‘Šselectorè¿™æ ·æ‹ä¸ªå¼¯çš„åšæ³•ã€‚ 1)ä»£ç¢¼æ¶æ§‹ï¼†è§£æ ä»¥ä¸‹æ˜¯JDJelllyButtonçš„å…ƒä»¶ï¼Œæˆ‘å°‡ç”±åº•å±¤çš„å­å…ƒä»¶å¾€ä¸Šè¬›è§£ã€‚ 123456var MainButton:JDJellyMainButton!var Container:JelllyContainer!var RootView:UIView?var delegate:JellyButtonDelegate?var _datasource:JDJellyButtonDataSource?var jellybutton:JDJellyButtonView? 1.1)ButtonGroupsç´€éŒ„äº†å¤šå€‹JDJellyButtonViewè·Ÿå®ƒå€‘å€‹åˆ¥çš„ä½ç½®ï¼Œæ­¤ç‚ºâ€œä¸€çµ„â€Button 1234struct ButtonGroups { var buttongroup:[JDJellyButtonView]! var groupPositionDiff:[CGPoint]?} 1.2)JDJellyButtonView:UIViewæ­¤ä¸€ç±»åˆ«æ˜¯å®ä½œæ¯ä¸ªæŒ‰é’®çš„åŸºç¡€æ ·å¼ä¸ç‚¹å‡»ï¼Œä¸€ä¸ªåœ†é…ä¸€å¼ å›¾ç‰‡ã€‚åˆ«å¿˜äº†è¦å¤„ç†ç‚¹å‡»çš„äº‹ä»¶ã€‚æˆ‘åšçš„æ–¹æ³•æ˜¯é€šçŸ¥å§”ä»»ï¼ˆä¸Šå±‚æ¥å£JDJellyButtonï¼‰è¢«ç‚¹å‡»çš„æ˜¯ç¬¬å‡ çš„Groupçš„ç¬¬å‡ ä¸ªButtonã€‚ 123protocol JellyButtonDelegate { func JellyButtonHasBeenTap(touch:UITouch,image:UIImage,groupindex:Int,arrindex:Int)} 12345678override func touchesBegan(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) { let image = self.imgView?.image let groupindex = dependingMainButton?.getGroupIndex() let arrindex = dependingMainButton?.getJellyButtonIndex(jelly: self) print(&quot;\\(groupindex),\\(arrindex)&quot;) tapdelegate?.JellyButtonHasBeenTap(touch: touches.first!,image: image!,groupindex: groupindex!,arrindex: arrindex!) } 1.3)JDJellyMainButton:JDJellyButtonViewæœ¬æ§ä»¶æœ€ä¸»è¦çš„ç±»åˆ«ï¼Œä¹Ÿæ˜¯æ•´ä¸ªå¯¼èˆªæµ®åŠ¨æŒ‰é’®çš„ä¸»ä½“ã€‚æ ·å¼è·Ÿå…¶ä»–çš„æŒ‰é’®ä¸€æ ·ï¼Œå·®åˆ«æ˜¯åœ¨ç‚¹å‡»åçš„äº‹ä»¶ä»¥åŠå®ƒå¯ä»¥æ‹–åŠ¨ï¼Œæ‰€ä»¥å°±ç›´æ¥ç»§æ‰¿JDJellyButtonViewå¹¶ä¸”è¦†å†™touchesBegan, touchesMovedï¼Œå¹¶ä¸”ä¹Ÿç”±å®ƒæ¥ç®¡ç†ButtonGroupsã€‚ 12345678910111213141516171819func appendButtonGroup(bgs:ButtonGroups){ var temp_bgs:ButtonGroups = bgs for jelly in temp_bgs.buttongroup { //è®©æ¯ä¸ªæŒ‰é’®çŸ¥é“è‡ªå·±ä¾é™„çš„æ˜¯è° //å› ç‚ºåªæœ‰MainButtonçŸ¥é“å­Buttonä½åœ¨ç¬¬å¹¾å€‹Group jelly.dependingMainButton = self } temp_bgs.groupPositionDiff = [CGPoint]() for i in 0..&lt;bgs.buttongroup.count { //è®¡ç®—ä½ç½® let cgpoint:CGPoint = CGPoint(x: x[i] , y: y[i]) temp_bgs.groupPositionDiff?.append(cgpoint) } buttongroups.append(temp_bgs)} éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºJDJellyButtonæœ‰åˆ†ç¾¤ç»„ï¼Œè€Œè§¦å‘çš„æ¡ä»¶æ˜¯â€œé•¿æŒ‰â€ï¼Œå› æ­¤æˆ‘ä»¬ä¸å†touchesBeganåšç«‹å³å±•å¼€ï¼Œè€Œæ˜¯åœ¨touchesEndedå¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 override func touchesBegan(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) { /* ç•¥ */ if(Expanding) { expandignMove = true closingButtonGroup(expandagain: false) } //ç´€éŒ„é»ä¸‹å»çš„æ™‚é–“ LastTime = touches.first!.timestamp /* ç•¥ */ }override func touchesEnded(_ touches: Set&lt;UITouch&gt;, with event: UIEvent?) { /* ç•¥ */ //çŸ­æŒ‰ if(touches.first!.timestamp - LastTime! &lt; 0.15){ if(!Expanding) { expandButtonGroup() } else { closingButtonGroup(expandagain: false) } } else //é•·æŒ‰ { if(!Moving) { switchButtonGroup() } if(expandignMove &amp;&amp; Moving) { expandButtonGroup() } } Moving = false expandignMove = false /* ç•¥ */ } 1.4)JelllyContainer:UIViewæœ¬æ¥å¹¶æ²¡æœ‰æ‰“ç®—åˆ¶ä½œè¿™ä¸ªç±»åˆ«ï¼Œåæ¥é‡åˆ°äº†ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼šè™½ç„¶æŒ‰é’®ä»¥å¤–é€æ˜çš„åœ°æ–¹çœ‹ä¼¼å¯ç‚¹å‡»åæ–¹çš„å…¶ä»–Viewï¼Œä½†æ˜¯å…¶å®ä¼šç‚¹åˆ°æµ®åŠ¨å¯¼èˆªæŒ‰é’®çš„æ•´ä¸ªèƒŒæ™¯ï¼Œè¿›è€Œæ— æ³•è§¦å‘åæ–¹ä½¿ç”¨è€…åŸæœ¬çš„ä¸œè¥¿ã€‚ä¸Šç½‘çˆ¬äº†ä¹‹åï¼Œå‘ç°éœ€è¦†å†™pointè¿™ä¸ªFunctionã€‚ 12345678override func point(inside point: CGPoint, with event: UIEvent?) -&gt; Bool { for subview in subviews { if !subview.isHidden &amp;&amp; subview.alpha &gt; 0 &amp;&amp; subview.isUserInteractionEnabled &amp;&amp; subview.point(inside: convert(point, to: subview), with: event) { return true } } return false }","link":"/blog/2017/01/05/JellyButton/"},{"title":"å‘Heroè‡´æ•¬èˆ‡åˆ†æ-(ä¸€)","text":"å‘Heroè‡´æ•¬èˆ‡åˆ†æ-(ä¸€)0)Who is Hero?å…¶å®æˆ‘ä¸€ç›´éƒ½ååˆ†é’Ÿæ„æœ‰å…³å¼ºåŒ–UIåŠŸèƒ½æˆ–æ˜¯åšä¸€äº›è¿‡åœºåŠ¨ç”»çš„å¼€æºåº“ï¼Œæœ€è¿‘åœ¨ç½‘ä¸Šå‡ºç°ä¸€æ¬¾éå¸¸ç«çš„è¿‡åœºåŠ¨åˆ’å¼€æºåº“ï¼ŒçŸ­çŸ­å‡ å¤©å†…å°±4000+ Strarï¼Œå®ƒçš„åå­—ä¹Ÿååˆ†çš„å¥½è®°ï¼Œå°±å« *â€Heroâ€*ã€‚ https://github.com/lkzhao/Hero æœ¬æ–‡æ’°å†™å‰ï¼Œå·²çŸ¥ä¼šä½œè€… 0.1)å¯¹æ­¤è‹±é›„çš„ç¬¬ä¸€å°è±¡å…¶å®HeroçœŸæ­£å¸å¼•æˆ‘çš„æ˜¯ä»–ç²¾ç¾çš„æ–‡æ¡ˆï¼Œå¦‚Heroå®ƒæ˜¯Foucusåœ¨ä¸¤ä¸ªUIViewControllerä¹‹é—´çš„UIViewControllerAnimatedTransitioningï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªUIViewControlleråˆ‡æ¢æ—¶çš„è¿‡åœºåŠ¨ç”»ï¼Œè€Œä»¥ä¸‹æ˜¯å®ƒé’ˆå¯¹ä»–çš„åŠŸèƒ½æä¾›çš„ç¤ºæ„åŠ¨ç”»ï¼š å¾ˆç®€æ´åˆä¸€ç›®äº†ç„¶ã€‚ 1)Heroâ€™s Show #1 - Simple Presentå’±ä»¬åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è®©å„ä½å®¢å®˜æ¥çœ‹å’±è‹±é›„å¤§çˆ·æœ€åŸºæœ¬çš„èƒ½è€ã€‚ è¿™æ ·çš„è¿‡åœºéœ€è¦å‡ è¡Œç¨‹å¼ç å‘¢ï¼Ÿ View Controller 1123456blueView.heroID = &quot;blue&quot;purpleView.heroID = &quot;purple&quot;greenView.heroID = &quot;green&quot;/* LabelåŒç†*/ View Controller 212345678isHeroEnabled = trueblueView.heroID = &quot;blue&quot;purpleView.heroID = &quot;purple&quot;greenView.heroID = &quot;green&quot;/* LabelåŒç†*/ é•¿è¯çŸ­è¯´ï¼ŒHeroåœ¨ä¸¤ä¸ªUIViewControlleråˆ‡æ¢ä¹‹é—´ï¼Œå°†å‰æ§åˆ¶å™¨é‡ŒID açš„ç‰©ä»¶ä½ç½®ç§»åˆ°åæ§åˆ¶å™¨åŒä¸ºID açš„ç‰©ä»¶ä½ç½®ã€‚è€Œæˆ‘ä»¬å°†è¦æ¢è®¨çš„å³æ˜¯è¿™ä¸ªâ€œåˆ‡æ¢â€ä¸­é—´ï¼Œä½œè€…æ˜¯å¦‚ä½•å®ä½œçš„ã€‚ 1.2)Present æµç¨‹ 1.2.1)Heroä¸ºTransitioningåšå‡†å¤‡ Hero:UIViewControllerTransitioningDelegate animationController:è¿™é‡Œå®ƒåšçš„äº‹å¾ˆç®€å•å°±æ˜¯æŠŠæ¥æºVCä¸ç›®æ ‡VCåšä¿å­˜çš„åŠ¨ä½œï¼Œä»¥ä¾¿æ—¥åå–ç”¨ã€‚ 123456func animationController(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? { self.presenting = true self.fromViewController = fromViewController ?? presenting self.toViewController = toViewController ?? presented return self } interactionControllerForPresentation:è¿™ä¸ªæ–¹æ³•è‹¥ä¸æ˜¯å›ä¼ Nullåˆ™éœ€è‡ªå·±å®ä½œUIViewControllerInteractiveTransitioningå¤„ç†ç›¸å…³å‚æ•°ï¼Œè‹¥æ˜¯Nullåˆ™ä»£è¡¨éInterActiveTransitionã€‚ InterActiveTransition:æœ€ç»å…¸ä¾‹å­åœ¨æœ‰NavigationControllerçš„æƒ…å†µä¸‹æ‰‹æŒ‡ä»è§å¹•æœ€å·¦ç«¯å¾€å³æ»‘åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šå±‚VCï¼Œåœ¨è¿˜æ²¡å®Œå…¨æ”¾å¼€çš„æœŸé—´è¿˜å¯ä»¥å·¦å³æ»‘åŠ¨ï¼Œç”šè‡³èƒ½æ”¾å›å»ä¸åšPOPã€‚ Hero: UIViewControllerAnimatedTransitioning animateTransition:è¿™ä¸ªéƒ¨åˆ†å¯ä»¥è¯´æ˜¯æ•´ä¸ªHeroçš„èµ·æºï¼Œä¹Ÿæ˜¯åœ¨åšVCçš„è¿‡åœºåŠ¨ç”»æ—¶ï¼Œä¸€å®šä¼šåšåˆ°çš„éƒ¨åˆ†ã€‚ä¸ºäº†æ˜ç¡®è¡¨è¾¾è¿™æ”¯functionï¼Œæœ¬ç¯‡åªå…ˆæåˆ°Contextï¼Œå…¶ä½™å°†åœ¨ç¬¬äºŒç¯‡ç»­è°ˆã€‚ 123456789101112public func animateTransition(using context: UIViewControllerContextTransitioning) { //transitionContext ä¼šåœ¨ end é‡Šæ”¾ if transitionContext != nil { return } transitionContext = context /* ç•¥.*/} åœ¨å®˜æ–¹æ–‡æ¡£é‡Œæ˜ç¡®åœ°æåˆ°ä¸å»ºè®®å®ä½œæ­¤ç±»åˆ«ï¼Œä»¥å…ç ´ååŸæœ¬ç³»ç»Ÿè‡ªå·±ä¼ é€’çš„Contextã€‚Heroä¹Ÿåªæ˜¯å•çº¯å°†å…¶è®°ä¸‹æ¥ã€‚ UIViewControllerContextTransitioning:è‹¥è¦ç”¨ä¸€ä¸ªè¯æ¥æ¦‚æ‹¬å®ƒï¼Œ åº”è¯¥å°±æ˜¯ã€ä¸Šä¸‹æ–‡ã€å§ï¼Œå°±å¥½åƒTransitionæ˜¯ä»‹äºä¸¤ä¸ªå¥å­(VC)é—´çš„é€—ç‚¹ï¼Œè€ŒContextå³è®°å½•äº†ä¸Šä¸‹ä¸¤å¥çš„è¯­æ„ã€‚é‡Œé¢è®°å½•äº†ä¸æ­¤è¿‡åœºç›¸å…³çš„æ§åˆ¶å™¨ã€ç”»é¢(view)ã€ä»¥åŠå¦‚ä½•è¿‡åœºï¼ˆstyle) ç¬¬äºŒç¯‡ï¼šhttp://www.jianshu.com/p/a7012ec2c5e5","link":"/blog/2017/01/10/Hero_part1/"},{"title":"WebViewå¦‚ä½•å¤„ç†ä¸å—ä¿¡ä»»çš„httpç½‘è·¯å‡­è¯","text":"WebViewå¦‚ä½•å¤„ç†ä¸å—ä¿¡ä»»çš„httpç½‘è·¯å‡­è¯æœ¬ç¯‡ä½¿ç”¨Swift å¹¶é™„ä¸Šå®˜æ–¹æ–‡æ¡£å‰é˜µå­æ¥äº†ï¼ˆå…¬å¸ï¼¡ï¼‰ä¸€ä¸ªä¸“æ¡ˆï¼Œå†åŠ ä¸Šè¦æ¯•ä¸šäº†ï¼Œå­¦æ ¡å„ç§å¿™ç¢Œï¼Œè·ç¦»ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰å¥½å¤§ä¸€æ®µæ—¶é—´â€¦ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªä¸“æ¡ˆç¢°åˆ°äº†äº›å°é—®é¢˜ï¼Œæ‰æƒ³æ¥å†™å†™ç¬”è®°ã€‚ ä¸€ã€èµ·å› å…¬å¸ï¼¡æœ‰ä¸ªåªé™å†…ç½‘ç”¨çš„å…¬æ–‡ç³»ç»Ÿï¼ˆä¼¼ä¹æ˜¯ç”¨javaå†™çš„ç½‘é¡µ?ï¼‰ï¼Œåˆ°ç›®å‰ä¸ºæ­¢éƒ½æ˜¯å•çº¯åœ¨Windowsä¸Šçš„å°ç¨‹å¼åˆ©ç”¨ã€URL Schemeã€è·Ÿè¿™ä¸ªç³»ç»Ÿäº’ç›¸ä¸¢æ¥èµ„æ–™ï¼Œæˆ‘åˆ™æ˜¯è¦è´Ÿè´£å†™ä¸€ä¸ªIOS App è·Ÿæ­¤ç³»ç»Ÿåšä¸€æ ·çš„äº‹ã€‚ä½†æˆ‘æ˜¯æ‰¿åŒ…çš„ï¼Œæ— æ³•åœ¨å…¬å¸ï¼¡çš„å†…ç½‘ä¸‹æµ‹è¯•ï¼Œç»è¿‡ä¸€ç•ªè®¨è®ºï¼Œä»–ä»¬å†³å®šå°†ç³»ç»Ÿåšä¸ªæµ‹è¯•ç”¨çš„çŒåœ¨windowsè™šæ‹Ÿæœºä¸Šï¼Œæˆ‘åœ¨Macä¸Šæ‰§è¡Œå°±ç­‰äºæˆ‘è·Ÿè¿™ä¸ªç³»ç»Ÿç›¸åŒå†…ç½‘ã€‚ äºŒã€å‰ç½®æµ‹è¯• ğŸ–¥ï¸å‡è®¾å„ä¸ªå†…ç½‘ipå¦‚ä¸‹ï¼š (A)Macï¼š192.168.1.1 (B)Macä¸Šçš„Windowsè™šæ‹Ÿæœº:192.168.1.2 (C)å®æœºIphoneï¼š192.168.1.3 (D)ç³»ç»Ÿç½‘å€ï¼šhttps://192.168.1.2:8888/Domain A ping B,C -&gt; OK ğŸ‘Œã€ B ping A,C -&gt; OK ğŸ‘Œ A é¢„è§ˆ D -&gt; OK ğŸ‘Œã€ B é¢„è§ˆ D -&gt; OK ğŸ‘Œ æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘è¦è¯´çš„ C é¢„è§ˆ D çš„çŠ¶å†µ ä¸‰ã€é—®é¢˜ä¸€ (UIWebView é¢„è§ˆ D) ğŸ¤” ç¬¬ä¸€ç§å°è¯•æ˜¯åˆ©ç”¨WebView, ä¸ºä»€ä¹ˆé¦–é€‰å®ƒå‘¢ï¼Ÿ å› ä¸ºä¸šä¸»ä¸å¸Œæœ›åœ¨ä¸¤ä¸ªAppä¹‹é—´åšè¿‡å¤šçš„åˆ‡æ¢(ä¸€æ•´ä¸ªæµç¨‹ä¸‹æ¥å¯èƒ½è·³è½¬ä¸¤~ä¸‰æ¬¡ï¼‰ï¼Œä¹Ÿä¸å¸Œæœ›ä½¿ç”¨è€…åœ¨ä¸‹æ¬¡å¼€å¯Safariæ—¶ï¼Œè¿˜åœç•™åœ¨ç³»ç»Ÿçš„é¡µé¢ã€‚ NSURLErrorDomain: -1003ï¼Ÿ WebViewå°±åœ¨æˆ‘LoadRequestæ—¶è·³å‡ºè¿™ä¹ˆä¸€ä¸ªé”™è¯¯ï¼Œçœ‹åˆ°ErrorDomainæ—¶ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å¤šæƒ³ï¼Œå°±ç›´æ¥è®¤ä¸ºåº”è¯¥æ˜¯æˆ‘DNSæ²¡è®¾å®šå¥½ä¹‹ç±»çš„é—®é¢˜ï¼Œäºæ˜¯åˆé‡å¼€äº†è™šæ‹Ÿæœºï¼Œé‡å¯ç«™å°...!@#!$ğŸ™„ğŸ™„ Safariå¯å¼€å¯ï¼Ÿ ä¼šçªç„¶ä½¿ç”¨Safariæ˜¯å› ä¸ºæˆ‘ä¸æƒ³ä¸€ç›´é‡æ–°Buildï¼Œå†…å¿ƒæƒ³è¯´ç»“æœä¸€æ ·ï¼Œæ²¡æƒ³åˆ°ï¼Œè·³å‡ºæ¥ä¸€ä¸ªè¿™æ ·çš„æç¤ºï¼š æŒ‰ä¸‹â€Continueâ€åï¼Œå°±æ˜¾ç¤ºå‡ºç³»ç»Ÿçš„é¡µé¢äº†ï¼ ä¸ä¿¡ä»»çš„çš„å‡­è¯ æœ‰äº†è¿™ä¸ªå¼¹çª—çš„æé†’ï¼Œæˆ‘æ‰æ˜ç™½é—®é¢˜çš„ç—‡ç»“ç‚¹åŸæ¥æ˜¯â€œå‡­è¯â€ï¼ŒåŸæ¥æ˜¯ä¹‹å‰IOS9çš„æ–°è®¾å®šï¼šApp Transport Security (ATS) ATSå‚è€ƒç½‘å€ï¼šhttps://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW33 åŸºæœ¬ä¸ŠATSå°±æ˜¯ä¸ºäº†è¦ç¡®ä¿ä½ çš„Appæ›´å®‰å…¨ï¼Œä¼šæŒ¡ä¸¤æ ·ä¸œè¥¿ä¸€ä¸ªå°±æ˜¯æ²¡æœ‰Securityçš„Httpä¸€ä¸ªæ˜¯ä¸ä¿¡ä»»å‡­è¯çš„Httpsï¼Œä¸ä¼šæ— æ„é—´è·‘åˆ°é’“é±¼ç½‘ç«™ä¹‹ç±»çš„ã€‚ ä¸‰ã€é—®é¢˜ä¸€è§£æ³•ğŸ“– è®¾å®šInfo.plist ç¬¬ä¸€ä¸ªæ–¹æ³•æœ€ç®€å•å°±æ˜¯ç›´æ¥å…³æ‰ATSï¼Œç›´æ¥åœ¨Info.plistå¢åŠ ä»¥ä¸‹å…¶ä¸­ä¸€å¯¹Key Value Pair 1.Allow Arbitary Loads ï¼ˆNSAllowArbitrayLoads) ç”¨é€”æ˜¯ï¼Ÿè§£é™¤æ‰€æœ‰è¿çº¿çš„ATSé™åˆ¶ï¼Œè¿™é‡ŒæŒ‡çš„æ‰€æœ‰è¿çº¿åŒ…æ‹¬URLRequest,URLConnection,URLSession,UIWebView....ç­‰ã€‚ ä½†æ˜¯å®˜æ–¹æ–‡ä»¶é‡Œä¹Ÿå¾ˆè¡¨æ˜å†™äº†ï¼Œåªè¦Allow Arbitary Loadsè¿™ä¸ªå€¼è¢«è®¾ä¸ºTrueï¼Œå°±æ²¡æœ‰åŠæ³•é€šè¿‡ä¸Šæ¶å®¡æ ¸ï¼Œæ‰€ä»¥æˆ‘ä¸é‡‡ç”¨æ­¤æ–¹æ³•ã€‚ 2.Exception Domain ï¼ˆNSExceptionDomains) ç”¨é€”æ˜¯ï¼Ÿæ’é™¤æŸä¸ªDomainä½¿å…¶ä¸å—ATSçš„é™åˆ¶ã€‚ ä¸ªäººè®¤ä¸ºè¿™ä¸ªKeyæ¯”è¾ƒé€‚åˆæ‹¿æ¥ä½¿ç”¨ï¼Œå¦‚æœä½ æ˜ç¡®çŸ¥é“è‡ªå·±ä¼šåœ¨æŸä¸ªDomainä¹‹ä¸‹çš„è¯ã€‚ è¿™ä¸ªKeyæˆ‘ä¸çŸ¥é“ä¼šä¸ä¼šå½±å“ä¸Šæ¶ï¼Ÿ å®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW35 HTTPS Server Trust Evaluation https://developer.apple.com/library/content/technotes/tn2232/_index.html#//apple_ref/doc/uid/DTS40012884-CH1-SECWEBVIEW å¦ä¸€ç§æ–¹æ³•å°±æ˜¯å®ä½œå®˜æ–¹æ–‡æ¡£é‡Œçš„ã€Trust Customization for Specific APIsã€ï¼Œä¹Ÿå°±æ˜¯è‡ªå®šä¹‰æŸä¸ªè¦æ±‚çš„å‡­è¯æ£€æŸ¥ 1.URLSession ä¾ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬éœ€è¦å®ä½œ urlSession(_:task:didReceive:completionHandler:)ï¼Œå¦‚æœå‡­è¯æ— æ³•éªŒè¯ï¼Œä¼šå‘å‡ºä¸€ä¸ªChallengeä¾›ä½ åˆ¤æ–­ä½ è¦æ‹’ç»è¿™ä¸ªè¿çº¿è¿˜æ˜¯æä¾›ä¸€ä¸ªå‡­è¯æ¥è§£å†³ï¼š éµå®ˆURLSessionDelegate 1let session = Foundation.URLSession(configuration: sessionConfig, delegate: self, delegateQueue: nil) å¤„ç† - **ã€Challengeã€** challenge : URLAuthenticationChallenge Challengeè¿™ä¸ªè¯å¹¶ä¸æ˜¯iosæˆ–CocoaFrameWorkæ‰æœ‰çš„ï¼Œè€Œæ˜¯äº’è”ç½‘ä¸­ä¼ºæœå™¨å‘ä½¿ç”¨è€…ç«¯å‘å‡ºçš„ã€**Challengeâ€“response authentication**ã€ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥éªŒè¯ç”¨æˆ·æˆ–ç½‘ç»œæä¾›è€…çš„åè®®ï¼Œä¼šè¦æ±‚ä½¿ç”¨è€…å›ä¼ ä¸€äº›èµ„è®¯ï¼Œå¸å·ã€å¯†ç ã€å‡­è¯...ç­‰ï¼Œåœ¨ä¸‹é¢ä¼šè¯´è¯´æœ‰å“ªäº›ã€‚ &gt; https://developer.apple.com/reference/foundation/urlauthenticationchallenge &gt;https://zh.wikipedia.org/zh-cn/CHAP 12345678910111213141516 func urlSession(_ session: URLSession, didReceive challenge: URLAuthenticationChallenge, completionHandler: @escaping (URLSession.AuthChallengeDisposition, URLCredential?) -&gt; Swift.Void){ //1 let protectionspace = challenge.protectionSpace //2 let authMethod = protectionspace.authenticationMethod if authMethod == NSURLAuthenticationMethodServerTrust { //3 let credential = URLCredential(trust: challenge.protectionSpace.serverTrust!) //4 let input:URLSession.AuthChallengeDisposition = .useCredential //5 completionHandler(input, credential) }} 1.***Challenge.protectionSpace*** : URLProtectionSpace -&gt; åŒ…å«äº†è¿™ä¸ª authentication requestçš„host,port...ç­‰ï¼Œè®©ä½ åˆ¤æ–­è¯¥ç”¨ä»€ä¹ˆ**credentialï¼ˆè¯ä¹¦ï¼‰**åº”ä»˜ã€‚ 2.***authenticationMethod*** ï¼š è¿™æ˜¯æˆ‘åˆšåˆšæåˆ°çš„ï¼Œä¼ºæœå™¨è¦æ±‚è®¤è¯çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šå†³å®šæ¥ä¸‹æ¥è¦åšçš„äº‹ï¼Œåƒæ˜¯ï¼šNSURLAuthenticationMethodHTTPBasic:è¦æ±‚ä½¿ç”¨è€…å›ä¼ å¸å·è·Ÿå¯†ç ï¼Œè€Œæˆ‘ä»¬è¦å¤„ç†çš„æ˜¯NSURLAuthenticationMethodServerTrustï¼Œè¦æ±‚ä½¿ç”¨è€…å›ä¼ ä¸€ä¸ªå‡­è¯ã€‚ 3.***URLCredential*** : è¿™ä¸ªç±»æœ‰å‡ ç§å·®å¼‚æ»¡å¤§çš„Init()ï¼Œä¸»è¦å°±æ˜¯çœ‹authenticationMethodæ¥å†³å®šä½ è¦å›ä¼ çš„æ˜¯ä»€ä¹ˆã€‚ ![](https://jamesdoubleblogphoto.oss-cn-shanghai.aliyuncs.com/iOSBlog/ArticleImages/2019/15770897288708.jpg) æˆ‘ä»¬è¿™æ¬¡è¦åšçš„æ˜¯å‡­è¯çš„å¤„ç†ï¼Œæ‰€ä»¥ç”¨ç¬¬äºŒä¸ªå»ºæ„ã€‚ &gt;https://developer.apple.com/reference/foundation/urlprotectionspace/nsurlprotectionspace_authentication_methods 4.URLSession.***AuthChallengeDisposition*** : è¡¨ç¤ºè¡Œä¸ºï¼ŒåŒ…æ‹¬è¦ä½¿ç”¨å‡­è¯ã€å–æ¶ˆæ­¤æ¬¡è¦æ±‚ã€æ‰§è¡Œé¢„è®¾åŠ¨ä½œ...ç­‰åˆ—ä¸¾ï¼Œæˆ‘ä»¬è¦ç”¨å‡­è¯æ‰€ä»¥ç”¨.useCredentialã€‚ 5.åˆ©ç”¨completionHandleå‘ŠçŸ¥ç»“æœï¼šï¼ˆä½¿ç”¨å‡­è¯,è¿™ä¸ªå‡­è¯ï¼‰ 2.UIWebView - å›å½’æ­£é¢˜æˆ‘ä»¬è¦ç”¨UIWebViewï¼Œä½†å®˜æ–¹æ–‡æ¡£å³æåˆ°æ— æ³•è‡ªå®šä¹‰Https server trustï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯è¦ç”¨ä¸Šé¢çš„æ–¹æ³•è§£å†³ã€‚ æ£˜æ‰‹çš„åœ°æ–¹æ˜¯UIWebViewåªèƒ½å•çº¯LoadingRequestè·Ÿç®¡ç†URLSessionï¼Œå¿…é¡»ç»•é“è€Œè¡Œã€‚ å®ä½œUIWebViewDelegateè®°ä½å¤±è´¥çš„Requestï¼Œå¹¶ä¸”å»ºç«‹ä¸€ä¸ªURLConnectionã€‚ 1234567891011121314 func webView(_ webView: UIWebView, shouldStartLoadWith request: URLRequest, navigationType: UIWebViewNavigationType) -&gt; Bool{ LastRequest = request return true} func webView(_ webView: UIWebView, didFailLoadWithError error: Error){ FailRequest = LastRequest if(FailRequest != nil) { let _:NSURLConnection = NSURLConnection(request: FailRequest! , delegate: self)! }} è™½ç„¶åˆšåˆšè®²çš„æ˜¯URLSessionï¼Œä½†ä¸¤ä¸ªç”¨æ³•å…¶å®æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éµå®ˆNSURLConnectionDelegateï¼Œå¹¶åœ¨æœ€åé‡æ–°Loadingä¸€æ¬¡Requestï¼Œè¿™æ ·åŒä¸ªRequestå°±å¯ä»¥é€šäº†ã€‚ 12345678910111213 func connection(_ connection: NSURLConnection, willSendRequestFor challenge: URLAuthenticationChallenge) { if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust { print(&quot;send credential Server Trust&quot;) let credential = URLCredential(trust: challenge.protectionSpace.serverTrust!) challenge.sender!.use(credential, for: challenge) } else{ challenge.sender!.performDefaultHandling!(for: challenge) } connection.cancel() SystemWebView.loadRequest(FailRequest!)}","link":"/blog/2017/06/06/WebViewVerify/"},{"title":"æ·±å…¥æ·ºå‡º Xcode Command Lines Tool(1) - åˆæ¢","text":"Xcodeå‘½ä»¤åˆ— = Xcode Command Lines Tool å¦‚æœä½ æ˜¯ä¸€å€‹iOS/Mac Developer æˆ–æ˜¯ä½ åœ¨ç”¨Macé–‹ç™¼ä»€éº¼å£å£çš„äº‹ ä½ ä¸€å®šå°é€™å€‹ç•«é¢ä¸é™Œç”Ÿï¼Œ ç„¶å¾Œæˆ‘å€‘åªéœ€è¦æŒ‰ä¸‹å®‰è£ï¼Œ ä¹‹å¾Œå°±èƒ½ç¹¼çºŒé–‹ç™¼å•¦ï¼ æœ¬æ–‡çµæŸ.... Ok, æ‰€ä»¥â€¦. é€™å€‹Dialogåˆ°åº•å¹«æˆ‘å€‘å®‰è£äº†ä»€éº¼ï¼Ÿ å®‰è£åœ¨å“ªï¼Ÿ ç‚ºä½•è¦å®‰è£ï¼Ÿ å®‰è£äº†ä»€éº¼å¦‚å½ˆçª—æ‰€èªª å‘½ä»¤åˆ—é–‹ç™¼è€…å·¥å…· (command line developer tools)ï¼Œå¯ä»¥å¾Apple Developerå–®ç¨ä¸‹è¼‰ æœ‰macOS SDK, LLVMç·¨è­¯å™¨, linkerâ€¦ç­‰é–‹ç™¼ç’°å¢ƒï¼Œ æˆ‘å€‘ä¹‹å¾Œå†ä¾†ä»”ç´°åœ°çœ‹çœ‹è£¡é¢çš„å…§å®¹ã€‚ é€™è£¡æœ‰ä¸€ç¯‡å®˜æ–¹å°å¸¸è¦‹é—œæ–¼Xcode Command Lineç™¼å•åšçš„FAQ Building from the Command Line with Xcode FAQ å®‰è£åœ¨å“ªç‚ºäº†å¾—çŸ¥å®‰è£çš„è·¯å¾‘ï¼Œæˆ‘å€‘ä½¿ç”¨ SuspiciousPackage æŸ¥çœ‹ä¸‹è¼‰dmgè£¡çš„.pkg å“¦ï¼ æ‰€ä»¥ Command Line Tools åœ¨macçš„ å”¯ä¸€è·¯å¾‘ å°±æ˜¯ /Library/Developer/CommandLineTools !!! ä»”ç´°çœ‹çœ‹ä¸Šä¸Šå¼µåœ–çš„æè¿° - å¦‚æœä½ æ˜¯ç”¨Xcode, Xcode æ˜¯è‡ªå¸¶ Command Line Toolsçš„ (è€çš„Xcodeæ˜¯ä¸é»˜èªå®‰è£çš„) é‚£æ”¾åœ¨ Xcode çš„å“ªå‘¢ï¼Ÿï¼Ÿ Xcode.app/Contents/Developer ç›®éŒ„çµæ§‹åŸºæœ¬é¡ä¼¼æ–¼å®‰è£åœ¨ Libraryçš„ç›®éŒ„çµæ§‹ï¼Œä½†æ˜¯å¤šäº†ä¸å°‘æ±è¥¿ï¼Œ æˆ‘å€‘æœƒåœ¨ä¹‹å¾Œæåˆ°ä»–å€‘ å¤šä»½ Command Line Toolsé‚£.. å¦‚æœèªªæˆ‘æœ‰å¤šä»½çš„ Xcode å“ªå°±æœ‰å¤šä»½çš„ Command Line Tools ?? ğŸ˜± åŸºæ–¼ç›®å‰çš„è¨è«–ï¼Œä½ çš„ mac é–‹ç™¼ç’°å¢ƒå¯ä»¥æ˜¯ä»¥ä¸‹é€™æ¨£çš„ æ–¼æ˜¯å°±æœ‰äº†ä¸‰é€£å•ï¼Œç¾åœ¨ä½¿ç”¨çš„æ˜¯å“ªä¸€å€‹ï¼Ÿæˆ‘è©²ç”¨å“ªä¸€å€‹ï¼Ÿæ€éº¼åˆ‡æ›æˆå¦ä¸€å€‹ï¼Ÿ Xcode-SelectTo answer your question. I bring you xcode-select ä½œç‚ºä¸€å€‹commandæŒ‡ä»¤ï¼Œåç¨±é‚„æ˜¯æŒºæ·ºé¡¯æ˜“æ‡‚çš„ï¼Œä¹Ÿè¨±ä½ ä¸¦ä¸é™Œç”Ÿã€‚ä¾†è®“æˆ‘å€‘æ•²å€‹ man xcode-select ç…ç…ğŸ‘€ æè¿°å…§å®¹ç°¡è¿°å¦‚ä¸‹ xcode-select ç®¡ç†è‘— xcodeçš„Developer Directoryä½ èƒ½è¼•é¬†å¾—ä½¿ç”¨ xcode-select â€“switch åœ¨å¤šå€‹ç‰ˆæœ¬çš„Xcodeä¹‹é–“åˆ‡æ›å°æ‡‰çš„é–‹ç™¼å·¥å…·è·¯å¾‘ï¼Œè€Œé€™äº›è·¯å¾‘å°‡è¢«ç”¨æ–¼ xcrun, xcodebuild, cc â€¦ xcrun, xcodebuildï¼Œé€™åˆé‡£å‡ºäº†è¨±å¤šç†Ÿæ‚‰ä¸éçš„æŒ‡ä»¤ï¼Œæˆ‘å€‘ä¸€æ¨£å¾Œé¢èªªã€‚ xcode-selectç”¨æ³•ï¼š -s &lt;path&gt;, --switch &lt;path&gt;: å°‡è·¯å¾‘æŒ‡å‘æŸå€‹Command Line Tools, ex: xcode-select --switch /Applications/Xcode.app -p, --print-path: æ‰“å°ç›®å‰æŒ‡å‘çš„è·¯å¾‘, ex: /Applications/Xcode.app/Contents/Developer -r, --reset: å°‡ä¹‹å‰ç”¨-s æŒ‡å®šçš„è·¯å¾‘é‡ç½®, (ç­†è€…æ˜¯æŒ‡å›applicationè£¡çš„xcode) --install: å½ˆå‡ºå®‰è£Command Line Toolsè¦–çª—ï¼Œå° é‚„æ˜¯å®ƒ ä¸Šé¢æè¿°æåˆ°xcodebuild..ç­‰æŒ‡ä»¤ç”¨çš„ç’°å¢ƒæ˜¯åŸºæ–¼xcode-selectæŒ‡å‘çš„è·¯å¾‘ï¼Œxcode-selectæä¾›äº†ä¸€å€‹ç’°å¢ƒè®Šé‡ï¼Œè®“ä½ èƒ½è‡¨æ™‚ä½¿ç”¨å…¶ä»–ç’°å¢ƒä¾†åŸ·è¡Œxcode command. 1env DEVELOPER_DIR=&quot;/Applications/Xcode-beta.app&quot; /usr/bin/xcodebuild xcode-selectçš„å¥½è™•æœ‰äº†é€™å€‹æ©Ÿåˆ¶ï¼Œæˆ‘å€‘å°±èƒ½åŒæ™‚æ“æœ‰å¤šå€‹é–‹ç™¼ç’°å¢ƒï¼Œä¸åŒçš„Swiftç‰ˆæœ¬, ä¸åŒçš„æ¨¡æ“¬å™¨ç‰ˆæœ¬â€¦è€Œæˆ‘å€‘ç·¨è­¯çš„æŒ‡ä»¤ä¸éœ€è¦ç”¨ /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild åªéœ€è¦çµ±ä¸€ç”¨ xcrun xcodebuildã€‚ xcode-select in Xcodeä½ å¯ä»¥åœ¨ Xcode -&gt; Preference -&gt; Locations å»é¸æ“‡è‡ªå·±å¾— Command Line Toolsï¼Œ åœ¨é€™è£¡é¸æ“‡ æ•ˆåŠ›ç­‰åŒæ–¼ xcode-select, æ‰€ä»¥ä¹Ÿæ˜¯éœ€è¦userå¯†ç¢¼ã€‚ ç‚ºä½•è¦å®‰è£ Command Line Toolsç¾åœ¨ä½ çŸ¥é“ command Line Tools â€˜å¤§æ¦‚æ˜¯å“ªäº›æ±è¥¿â€™, â€˜æ”¾åœ¨å“ªäº›åœ°æ–¹â€™ ç•¶ç„¶ä½ å¯èƒ½ä¹Ÿå·²ç¶“çŸ¥é“è¨±å¤štoolçš„ç”¨é€”ï¼Œä¾‹å¦‚å¾ˆç†Ÿæ‚‰çš„xcodebuildï¼Œä½†æ—¢ç„¶æˆ‘éƒ½å¾é ­è¬›äº†ï¼Œå°±è¬›å…¨ä¸€é» ğŸ˜…ğŸ˜… For Xcode å°±åƒå¤§éƒ¨åˆ†çš„è»Ÿä»¶ä¸€æ¨£ï¼Œæˆ‘å€‘çœ‹åˆ°çš„,æ“ä½œçš„éƒ½æ˜¯è»Ÿä»¶çš„GUIï¼Œè€ŒXcodeçš„åº•å±¤å°æ‡‰çš„å°±æ˜¯Command Line Tool, ä¾‹å¦‚æŒ‰ä¸‹ Buildéµ =&gt; xcodebuid â€¦, é–‹ä¸€å°æ¨¡æ“¬å™¨ =&gt; simctl â€¦ï¼Œç•¶ç„¶é€™äº›éƒ½ä¸æ˜¯ä¸€å°ä¸€çš„æ˜ å°„ï¼Œè€Œæ˜¯å¤šå€‹command çš„çµ„åˆã€‚ æˆ‘å€‘ä¹‹å¾Œæœƒä»‹ç´¹å¹¾å€‹å¸¸è¦‹çš„çµ„åˆã€‚ For othersç„¶è€Œå°±ç®—ä½ ä¸æ˜¯ä½¿ç”¨Xcodeé–‹ç™¼ï¼Œé‚„æ˜¯æœƒç¢°åˆ°éœ€è¦å®‰è£Command Line Toolsçš„æƒ…æ³(ä¹Ÿå°±æ˜¯ä½¿ç”¨å®‰è£åœ¨/Library/Developer/CommandLineToolsçš„é‚£çµ„)ï¼Œå› ç‚ºToolsä¹Ÿæœ‰åŒ…å«æ•´å€‹MacOSçš„SDKé‚„æœ‰ç·¨è­¯å™¨Clangç”šè‡³åŒ…æ‹¬Makeã€‚ ä¾‹å¦‚æœ‰ä½¿ç”¨Homebrewåœ¨ç®¡ç†packageçš„ä¸€äº›pythoné–‹ç™¼æˆ–æ˜¯jsçš„é–‹ç™¼ï¼Œéƒ½æœƒæç¤ºéœ€è¦Xcode Command Line Tools. Futher Moreç¾åœ¨æˆ‘å€‘çŸ¥é“ Command Line Tools æ˜¯ä»€éº¼ï¼Œå®‰è£åœ¨å“ªï¼Œä»¥åŠCommand Line Tools æœ‰å¤šå€‹ã€‚ ä¹‹å¾Œçš„ä¸€ç³»åˆ—æ–‡ç« æˆ‘æœƒä¾†ä»‹ç´¹ Command Line Toolsè£¡ï¼Œç¢ºåˆ‡åŒ…å«äº†å“ªäº›å‘½ä»¤åˆ—å·¥å…· â€“ æ·±å…¥æ·ºå‡º Xcode å‘½ä»¤åˆ—(1) - åˆæ¢æ·±å…¥æ·ºå‡º Xcode å‘½ä»¤åˆ—(åŠ é¤) - libxcselect.dylib","link":"/blog/2019/12/19/xcCmdLine-1/"},{"title":"å¹´è½»äººï¼Œå¬è¯´ä½ æƒ³ä½¿ç”¨Framework - åŸºç¤è§€å¿µ","text":"Frameworks æœ¬æ–‡ç‚ºè­¯æ–‡ï¼Œä¸¦å·²å–å¾—ä½œè€…Nick TeissleråŒæ„ã€‚åŸæ–‡éˆæ¥ï¼šåŸæ–‡ æœ¬æ–‡ç« é©åˆåˆå­¸Frameworkçš„è®€è€…ã€‚ å‰è¨€Apple å·²ç¶“å°‡ iOS, macOS çš„ä»£ç¢¼åˆ†æˆ Modules, libraries, frameworksã€‚ Frameworks çš„è¨­è¨ˆä¸å–®å–®åªæ˜¯ç‚ºäº†å°è£è³‡æºè·Ÿæ¨¡å¡ŠåŒ–ä»£ç¢¼ï¼Œæ›´ä¸åªæ˜¯ç‚ºäº†æ¸›å°‘ä»£ç¢¼çš„é‡ç·¨è­¯æ™‚é–“è€Œå·²ã€‚ è¦æƒ³æ¸›è¼•ä»£ç¢¼é‡ã€åŠ é€ŸDebugã€å¢åŠ ä»£ç¢¼å¾©ç”¨æ€§ï¼Œå°±ä¸èƒ½åªçŸ¥é“Frameworkæ˜¯ä¸€å€‹å¯ä»¥æ‹–ä¾†æ‹–å»çš„å·¥å…·ç®±ï¼Œå¿…é ˆæ›´è¿‘ä¸€æ­¥çš„äº†è§£é€™äº›ï¼š éœæ…‹åº« - Static Libraries å‹•æ…‹åº« - Dynamic Libraries Frameworkçš„çµæ§‹ Linking éˆæ¥ èˆ‡ Embed åµŒå…¥çš„ä¸åŒ Q &amp; A ä»¥ä¸‹å…§å®¹é©ç”¨ macOS, tvOS, iOS. å¯èƒ½æœƒéš¨æ™‚é–“æœ‰æ”¹å‹•ã€‚ éœæ…‹åº« Static Librariesåœ¨éœæ…‹åº«ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆå¾Object Fileèªªèµ·ï¼Œä»¥åŸºç¤çš„è§’åº¦ä¾†èªªï¼Œobject files å°±æ˜¯å€‹æœ‰çµæ§‹çš„ä½å…ƒå¡Šã€‚é€™äº›ä½å…ƒå¡ŠåŒ…å«è‘—ä¸€äº›ç¨‹åºä»£ç¢¼ã€æœ‰äº›åŒ…å«è‘—æº–å‚™çµ¦Linkerè·ŸLoaderä½¿ç”¨çš„è³‡æ–™çµæ§‹ã€‚ å¯ä»¥è©¦è‘—åœ¨çµ‚ç«¯è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œç„ä¸€çœ¼objectfileçš„æ¨£å­ 1objdump -macho -section-headers /bin/ls Objectfilesé€šå¸¸ä»¥å››ç¨®å½¢å¼ç™»å ´ Relocatable: åŒ…å«å¯ä»¥åœ¨ç·¨è­¯æ™‚å¯è¢«å…¶ä»–Relocatable Linkçš„ä»£ç¢¼å’Œæ•¸æ“šï¼Œä»¥å…±åŒè£½ä½œæˆExecutableã€‚ Executableï¼šæº–å‚™å¥½è¼‰å…¥è¨˜æ†¶é«”çš„å¯åŸ·è¡Œæª”ã€‚ Shared: ä¸€ç¨®ç‰¹æ®Šçš„Relocatable fileï¼Œæ¦‚å¿µé¡ä¼¼ å‹•æ…‹åº«ã€‚ Bundle: æˆ‘å€‘ä¸ç‰¹åˆ¥æè¿°Bundle, åœ¨macOSä¸Šé€šå¸¸ç•¶ä½œæ’ä»¶ä½¿ç”¨ã€‚ è­¯æ–‡å¤–è£œå……:Relocatable:åŒ…å«è‘—èƒ½èˆ‡å…¶ä»–relocatableåœ¨ç·¨è­¯æ™‚é€²è¡ŒLinkedçš„ä»£ç¢¼(åŸ·è¡Œä»£ç¢¼)ä»¥åŠæ•¸æ“š(è®Šé‡å…¨å±€æ•¸æ“š)ã€‚Shared: ç·¨è­¯æ™‚åªä¾Headerä½œapiä¸Šçš„ç¢ºèªï¼Œä¸åŒ…é€²ä»»ä¸€Executableï¼Œå…±äº«æ–¼Executableä¹‹é–“ã€‚ è‹¥ä½ å˜—è©¦ç·¨è­¯ä¸€æ®µæ²’æœ‰ mainå‡½æ•¸çš„ C ä»£ç¢¼ï¼Œæœƒå¾—åˆ°ä¸€å€‹ relocatable object file fancy.c 123456void fancySwap(int *xp, int *yp) { if (xp == yp) return; // try it! *xp = *xp ^ *yp; *yp = *xp ^ *yp; *xp = *xp ^ *yp; } åœ¨Terminalè¼¸å…¥ 1cc -c fancy.c ç”¢å‡ºçš„ fancy.o æ˜¯ä¸€ç¨® objectFile ï¼ŒåŒ…å«è‘— fancySwap ç¬¦è™Ÿä»¥åŠå°æ‡‰çš„å¯¦ç¾ã€‚ç‚ºäº†æ›´æ–¹ä¾¿åœ°è™•ç† Relocatable object filesï¼Œå¤šå€‹object filesèƒ½è¢«å°è£æˆ .a (a ä»£è¡¨è‘— archive) .a æª”ä¹Ÿè¢«ç¨±ä½œ éœæ…‹åº«(static library) æˆ– éœæ…‹æ­¸æª”(static archive)ã€‚ ç•¶executableä¸­æŸfunction æˆ– æ•¸æ“šä¾†è‡ªæ–¼ .aï¼Œlinkeræ˜¯èƒ½å¤ æ™ºèƒ½åœ°åªéˆæ¥å…¶å°æ‡‰çš„ç¬¦è™Ÿï¼Œä½†æ˜¯ï¼Œlinkeré‚„æ˜¯æœƒå°‡æ‰€æœ‰çš„é€™äº›.aè£¡çš„ä»£ç¢¼çµ¦ä¸€å€‹å›ºå®šçš„loadåœ°å€ä¸¦åŒ…å«(copies and relocates)é€²executableä¸­ï¼Œé€ æˆè‚¥å¤§çš„executableï¼Œä¸”å¢é•·è®€é€²memoryçš„æ™‚é–“ã€‚ ç•¶ä½ æœ‰10å€‹æ‡‰ç”¨ä½¿ç”¨æ­¤éœæ…‹åº«ï¼Œå°±éœ€è¦å€‹åˆ¥æœ‰ä¸€ä»½copyï¼Œä¹Ÿå°±æ˜¯åå€‹å¾©æœ¬ï¼è€Œä¸”è‹¥æ˜¯éœæ…‹åº«çš„é–‹ç™¼è€…æ›´æ–°äº†ä»£ç¢¼ï¼Œå‰‡æ‰€æœ‰çš„æ‡‰ç”¨éƒ½å¿…é ˆé‡æ–°ç·¨è­¯ä¸€éã€‚è€Œå‹•æ…‹åº«å°±æ˜¯ç‚ºäº†è§£æ±ºé€™ä¸€æ­¥ä¾¿åˆ©æ€§è€Œèª•ç”Ÿçš„ã€‚ å‹•æ…‹åº« Dynamic Librarieså‹•æ…‹åº« (ä¹Ÿç¨±ä½œShared Library, Shared object, å‹•æ…‹éˆæ¥åº«)ï¼Œ è·Ÿéœæ…‹åº«ä¸€æ¨£æ˜¯å¤šå€‹object fileså°è£èµ·ä¾†çš„ï¼Œä¸ä¸€æ¨£çš„æ˜¯å‹•æ…‹åº«åªæœ‰åœ¨ç¨‹åºçš„è¼‰å…¥æ™‚é–“(load time)æˆ–é‹è¡Œæ™‚(Run time)æœƒè¢«è¼‰å…¥ï¼Œä¸¦ä¸”åœ¨memoryéš¨æ©Ÿçš„é…ç™¼ä¸€æ®µåœ°å€ã€‚ ä»¥ä¸Šè¡Œç‚ºæ˜¯ç”±å‹•æ…‹éˆæ¥å™¨(Dynamic linker, macOSç¨±dyld)ä¾†å®Œæˆï¼Œå‹•æ…‹åº«åœ¨ï¼š macOSä¸Š ä»¥ .dylib å­˜åœ¨ windowsä¸Š ä»¥ .DLL å­˜åœ¨ linuxä¸Š ä»¥ .so å­˜åœ¨ ç„¶è€Œåœ¨é‹è¡Œæ™‚é€²è¡Œæ‰åšéˆæ¥å…¶å¯¦æ˜¯ä¸€å€‹ç¬¨é‡çš„è² æ“”ï¼Œæ‡‰åˆç†å®‰æ’å“ªäº›åº«éœ€è¦Loadä»¥åŠæ™‚æ©Ÿã€‚ åœ¨ Treminalè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹æ›´å¤šé—œæ–¼å‹•æ…‹è¼‰å…¥çš„å…§å®¹ 1man dlopen Shared object è§£æ±ºäº†å‰é¢static object filesçš„å•é¡Œ ç¾åœ¨å¤šå€‹executableåªå‹•æ…‹éˆæ¥åˆ° å‹•æ…‹åº«çš„ã€å”¯ä¸€ã€æ‹·è²ã€‚ æ›´æ–°åº«ä¸¦ä¸å½±éŸ¿executable åº«çš„ä¾è³´æœƒè¢«è‡ªå‹•è¼‰å…¥ä¸”éˆæ¥\bï¼ˆä¾è³´åº«å¿…é ˆåœ¨search pathè£¡ï¼‰ macOS å¤§è¦æ¨¡çš„ä½¿ç”¨shared librariesï¼Œå¯ä»¥å‰å¾€è·¯å¾‘ /usr/libæ–‡ä»¶å¤¾æŸ¥çœ‹ç³»çµ±çš„å‹•æ…‹åº«ã€‚ å¦‚æœä½ æƒ³è¦ä½¿ç”¨è‡ªå·±çš„å‹•æ…‹åº«ï¼Œå¿…é ˆç¢ºä¿å®ƒè¢« embedded é€²ä½ çš„Appè£¡ã€‚ çœ‹å®Œä¸Šé¢é€™æ®µï¼Œä½ å¯èƒ½æœƒæƒ³ â€œå¤ªå¥½äº†, æˆ‘ä¸éœ€è¦é‡ç·¨è­¯äº†ï¼Œä½†æˆ‘æœ€å¥½ç‚ºæˆ‘åº«çš„ä½¿ç”¨è€…æä¾›å…¼å®¹æ€§â€ã€‚ æ˜¯çš„æ²’éŒ¯ï¼Œä½ çš„ç¢ºéœ€è¦è€ƒæ…®æ¯ç•¶ä½ updateå‹•æ…‹åº«æ™‚ï¼ŒAPIçš„å…¼å®¹æ€§ï¼Œæˆ–è¨±é€™ä¹Ÿæ˜¯ä½ æ­£åœ¨çœ‹é€™ç¯‡æ–‡ç« çš„åŸå› .. å­¸ç¿’ä¸€ç¨®å…·æœ‰åœ°å€å…¼å®¹æ€§çš„bundlingæ ¼å¼ - Framework Frameworkä¸€å€‹Frameworkå…¶å¯¦å°±æ˜¯ä¸€å€‹æœ‰è‘—ç‰¹å®šçµæ§‹çš„æ–‡ä»¶å¤¾è£è‘—å„ç¨®å…±äº«çš„è³‡æºã€‚ é€™äº›è³‡æºé€šå¸¸æ˜¯ åœ–ç‰‡ã€Xibsã€å‹•æ…‹åº«ã€éœæ…‹åº«ã€æ–‡æª”â€¦ç­‰ï¼Œä»–å€‘è¢«å°è£æˆbundleå­˜å„²å»åˆä¸åƒå…¶ä»–çš„bundles( åƒæ˜¯ .app)ï¼ŒFrameworkæ¯«ä¸æ©é£¾çš„è¡¨æ˜å®ƒç´”ç²¹å°±æ˜¯ä¸€å€‹æ–‡ä»¶å¤¾ã€‚ é€™è£¡æŒ‡çš„Bundleä¸¦ä¸æ˜¯ä¸Šé¢æ‰€æåŠçš„Bundle Object Headersé€™æ–‡ä»¶å¤¾åŒ…å«äº†Frameworkå°å¤–å…¬é–‹çš„C &amp; Obj-C headersï¼ŒSwift ä¸¦ä¸æœƒç”¨åˆ°é€™äº›Headersï¼Œå¦‚æœä½ çš„frameworkæ˜¯ç”¨Swiftå¯«çš„ï¼ŒXcodeæœƒè‡ªå‹•å¹«ä½ å‰µå»ºé€™å€‹æ–‡ä»¶å¤¾ä»¥æä¾›äº’ç”¨æ€§ã€‚ è‹¥ä½ æœ‰æ™‚ä¸æ¸…æ¥šåœ¨Swiftä»£ç¢¼è£¡åŠ  @objc, @objcMembers çš„å½±éŸ¿ï¼Œå¯ä»¥æŸ¥çœ‹ Build Settings è£¡â€œSWIFT_OBJC_INTERFACE_HEADER_NAMEâ€æ‰€æŒ‡çš„æ–‡ä»¶ï¼Œä¸¦è©¦è‘—æ”¹å‹•@objc @objcMembersçš„å®£å‘Šï¼Œçœ‹çœ‹é€™äº›æ”¹å‹•å°é€™æ–‡ä»¶çš„å½±éŸ¿ã€‚ Modulesé€™æ–‡ä»¶å¤¾åŒ…å«äº†LLVM, Swift çš„ Moduleä¿¡æ¯ã€‚ .modulemapæª”æ¡ˆæ˜¯çµ¦Clangä½¿ç”¨çš„ã€‚ é—œæ–¼Clang å¯çœ‹è­¯è€…çš„å¦ä¸€ç¯‡æ–‡ LLVMå‰ç«¯Clang .swiftmodule æ–‡ä»¶å¤¾ä¸‹çš„æª”æ¡ˆé¡ä¼¼headersï¼Œä½†æ˜¯ä¸åƒæ˜¯ headers, é€™äº›æª”æ¡ˆæ˜¯äºŒé€²åˆ¶çš„ä¸”â€œç„¡æ ¼å¼ä¹Ÿæœ‰å¯èƒ½æœƒæ”¹è®Šâ€ï¼Œåœ¨ä½ Cmd-click ä¸€å€‹Swiftå‡½æ•¸æ™‚Xcodeå°±æ˜¯åˆ©ç”¨é€™äº›æª”æ¡ˆå»å®šä½å…¶æ‰€å±¬çš„moduleã€‚ å„˜ç®¡é€™äº›éƒ½æ˜¯äºŒé€²åˆ¶æ–‡ä»¶ï¼Œä½†ä»–å€‘ä»æ˜¯ä¸€ç¨®å« llvm bitcode çš„çµæ§‹ï¼Œæ­£å› å¦‚æ­¤ï¼Œæˆ‘å€‘èƒ½ç”¨llvm-bcanalyzer and llvm-stringså–å¾—ç›¸é—œä¿¡æ¯ã€‚ MyCustomFrameworké›–ç„¶ä»–è¢«finderæ¨™è¨»æˆUnix executableï¼Œä½†ä»–å…¶å¯¦æ˜¯ä¸€å€‹ relocatable shared object file Resourcesæœ¬åœ°åŒ–çš„è³‡æº, xibs, æª”æ¡ˆ, åœ–ç‰‡â€¦ è·Ÿå…¶å®ƒè³‡æºå­˜æ”¾åœ¨é€™ åœ–ç‰‡è£¡çš„ç®­é ­ (Frameworkç‰ˆæœ¬)é€™äº›ç®­é ­éƒ½æ˜¯ symlink ç¬¦è™Ÿé€£çµ(æ·å¾‘)ã€‚ æ¯ç•¶ç”¢ç”Ÿä¸€å€‹æ–°ç‰ˆæœ¬æ™‚ï¼Œæœƒè¢«æ”¾é€² Versions/B. Current çš„ç®­é ­æœƒè¢«æ›´æ–°æˆæŒ‡å‘ Bã€‚ èˆ‡æ­¤åŒæ™‚ï¼ŒåŸæœ¬å‹•æ…‹éˆæ¥åˆ°Açš„ç¨‹åºä»æœƒä¿æŒéˆæ¥Aè€Œä¸æ˜¯Currentï¼Œæ€éº¼è¾¦åˆ°çš„ï¼Ÿ æ¯ç•¶executable åœ¨ç·¨è­¯æ™‚ï¼Œ dynamic linkeræœƒç´€éŒ„èˆ‡è‡ªå·±æœ‰å…¼å®¹çš„Frameworkè·¯å¾‘ã€‚ But ç¾ä»ŠAppleå·²é®®å°‘ä½¿ç”¨é€™å€‹åŠŸèƒ½äº† Xcode è£¡ Linking vs. Embedding Frameworksé€™è£¡æˆ‘å€‘ä¾†è¨è«–Xcodeè£¡ä¸€äº›å¸¸è¦‹çš„è¨­å®šï¼ŒTargetçš„ general settings. é€šå¸¸éœ€è¦ä½¿ç”¨Frameworkæ™‚ï¼Œéƒ½æœƒé¸æ“‡ â€œLinked Frameworks and Librariesâ€ï¼Œé™¤éä½ æ‰“ç®—åœ¨ runtimeçš„æ™‚å€™æ‰åšéˆæ¥è·Ÿè¼‰å…¥(å‰é¢æåŠçš„dlopen)ã€‚ Linking å’Œ Embedding çš„å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ ç‚ºä»€éº¼ç•¶ä½ Embedä¸€å€‹Frameworkæ™‚ï¼ŒXcodeè‡ªå‹•å°‡FrameworkåŠ åˆ°Linkå€ï¼Ÿ æƒ³ä¸€ä¸‹å‰›å‰›åœ¨è®€éçš„ï¼Œdylibså„²å­˜åœ¨å“ªï¼Ÿç•¶ä½ æƒ³è¦ç”¨è‡ªå·±çš„dylibæ™‚è©²åšä»€éº¼ï¼Ÿ æ˜¯çš„ï¼Embedding å¯¦éš›ä¸Šå°‡Frameworkæ‹·è²ä¸€ä»½åˆ°ä½ çš„application bundleè£¡Frameworksæ–‡ä»¶å¤¾ä¸‹ï¼Œ ç³»çµ±åº«æ˜¯ iOS å’Œ macOS è‡ªå¸¶çš„ï¼Œä½ å¯ä»¥æ”¾å¿ƒçš„éˆæ¥ä»–å€‘ï¼Œä½†æ˜¯ä½ è‡ªå·±çš„Framewroksä¸¦ä¸æ˜¯ç³»çµ±è‡ªå¸¶çš„ï¼Œå› æ­¤ä½ å¿…é ˆè¦embedded åˆ° application bundleè£¡ã€‚ è€Œä½ çš„æ‡‰ç”¨è‹¥æ˜¯æ²’æœ‰Linkingå®ƒä¹Ÿæ²’æœ‰ä»»ä½•ç”¨ï¼Œæ‰€ä»¥Xcodeè‡ªå‹•å¹«ä½ åšäº†éˆæ¥ã€‚ â˜…â˜… Linking and embeddingé–“æ¥çš„æš—ç¤º å‹•æ…‹ æˆ–æ˜¯ éœæ…‹éˆæ¥ï¼Œ æˆ‘å€‘ç¾åœ¨çŸ¥é“embeddingä¸€å€‹éœæ…‹åº«æ˜¯ä¸åˆç†çš„ï¼Œå› ç‚ºéœæ…‹åº«çš„ç¬¦è™Ÿå·²ç¶“è¢«ç·¨è­¯é€²executableï¼Œæ‰€ä»¥ Xcodeä¸æœƒæ‡‰è®“ä½ å°‡static libraryæ”¾åˆ° Embedè£¡ (ä½†å…¶å¯¦Xcodeæœƒè®“ä½ æ”¾ï¼Œç„¶è€Œé€™æ˜¯å¾ˆæ²’æ•ˆç‡çš„ä½¿ç”¨ï¼Œæ‰€ä»¥ä½ ä¸è©²é€™éº¼åšï¼‰ æŠ€è¡“ä¸Šä¾†è¬›ï¼ŒmacOSæ˜¯å¯ä»¥è®“ä½ åœ¨runtimeæ™‚å»è¼‰å…¥ä¸€å€‹éœæ…‹çš„ .a fileçš„ï¼Œä¸¦æ¨™è¨˜ä¸€å¡Šè¨˜æ†¶é«”ç•¶ä½œæ˜¯ executableï¼Œ é€™æ¨£åšèƒ½æœ‰æ•ˆçš„è¼‰å…¥éœæ…‹åº«ï¼Œç„¶è€Œé€™æŠ€è¡“æ˜¯ç”± JIT compilerså®Œæˆçš„ï¼ŒiOSä¸¦æ²’æœ‰æ¨™è¨˜è¨˜æ†¶é«”çš„èƒ½åŠ›ã€‚ â˜…â˜… è½èªªä½ æƒ³è¦ä½¿ç”¨ Frameworkåœ¨ä½ ä½¿ç”¨Frameworkæˆ–æ˜¯å°‡è‡ªå·±çš„ä»£ç¢¼åšæˆFrameworkæ™‚ï¼Œæœ‰å“ªäº›å› ç´ è¦è€ƒæ…®çš„ï¼Ÿ ä½ è¦é–‹ç™¼ä¸€çµ„æ‡‰ç”¨å—ï¼Ÿå¦‚æœæ˜¯ï¼Œé€™å°±æ˜¯Frameworkæœ¬è³ªçš„ä¸€éƒ¨åˆ† - åˆ†äº« Frameworksï¼Œä½ éœ€è¦å»å»ºä¸€å€‹åŒ…å®‰è£å™¨æŠŠ shared frameworksæ”¾é€² /Library/Frameworks or ~/Library/Frameworks. ä½ çš„å¤šå€‹appså…±äº«è‘—äº›è¨±çš„é‡è¤‡ä»£ç¢¼å—ï¼Ÿä½¿ç”¨frameworkæˆ–è¨±ä¸æ˜¯æœ€å¥½çš„é¸æ“‡ï¼Œå¦‚æœåªæ˜¯è¦å…±äº«ä¸€å€‹éå¸¸å°é‡çš„ä»£ç¢¼ï¼Œç‚ºäº†ä¿æŒåŒæ­¥çš„ æ‰“åŒ…å’Œç‰ˆæœ¬æ§åˆ¶åè€Œæœƒæˆç‚ºè² æ“”ã€‚ ä½ æƒ³è©¦è‘—æ¨¡å¡ŠåŒ–ä½ çš„ä»£ç¢¼å—ï¼Ÿå¦‚æœä½ æƒ³è¦å°‡ä»£ç¢¼ç§»é€²Frameworkä¸¦å°‡å®ƒè®Šæˆæ¨¡çµ„ï¼Œæœ€å¥½æ³¨æ„ Swiftâ€™s access control. åˆ¥å°‡Frameworkç•¶ä½œèƒ½ä¸é‡æ–°ç·¨è­¯çš„è¬éˆä¸¹ï¼Œæœ‰äº›é …ç›®æœƒå°‡ä»£ç¢¼ä¸­æ¥µå¤§é‡å¿«å®Œæˆçš„éƒ¨åˆ†ç§»å‹•åˆ°Frameworkä»¥æå‡ç·¨è­¯é€Ÿåº¦ï¼Œé€™æ¨£åšçš„ç¢ºèƒ½é™ä½æ™‚é–“ï¼Œå¦‚æˆ‘å€‘æ‰€çŸ¥Frameworkä¸éœ€é‡æ–°ç·¨è­¯ï¼Œç„¶è€Œé€™æ¨£çš„æ–¹å¼æœƒä½¿æ¨¡å¡Šæ›´è¤‡é›œï¼ŒDebug, æ¸¬è©¦é›£åº¦æå‡ã€‚ ä½ è¦å°‡ä»£ç¢¼åšæˆç¬¬ä¸‰æ–¹åŒ…çµ¦å…¶ä»–äººä½¿ç”¨å—ï¼Ÿé€™æƒ…æ³ä¸‹ï¼Œä½ å¯ä»¥é¸æ“‡ä½¿ç”¨å‹•æ…‹åº« éœæ…‹åº« æˆ–Frameworkã€‚macOS, iOSå·²é€æ¼¸ç¿’æ…£å‹•æ…‹Framewrokäº†ï¼Œå› ç‚ºä»–çš„è¼•ä¾¿æ€§ã€æ™®éä»¥åŠæ˜“ç”¨æ€§ã€‚ Sources John Levineâ€™s â€œLinkers and Loadersâ€ https://www.iecc.com/linker/ Bryant, R., OHallaron, D. R., &amp; S., M. (2016). Computer systems: a programmers perspective. Harlow, Essex: Pearson. â€œ[swift-users] Where to read about *.swiftmodule file format?â€ https://lists.swift.org/pipermail/swift-users/Week-of-Mon-20171127/006660.html â€œDynamic-Library Programming Topics: Run Path Librariesâ€ https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPFrameworks/Tasks/CreatingFrameworks.html#//apple_ref/doc/uid/20002258-106880 â€œPew Pew the Spells: Static and Dynamic Librariesâ€ https://pewpewthespells.com/blog/static_and_dynamic_libraries.html â€œDynamic Library Programming Topics: Using Dynamic Librariesâ€ https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/UsingDynamicLibraries.html#//apple_ref/doc/uid/TP40002182-SW10 â€œApple Technical Note: Embedding Frameworks in an Appâ€ https://developer.apple.com/library/content/technotes/tn2435/_index.html#/apple_ref/doc/uid/DTS40017543-CH1-EMBED_IN_APP_SECTION â€œSwift and Objective-C in the Same Projectâ€ https://developer.apple.com/library/content/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html â€œFramework Programming Guide: Installing Your Frameworkâ€ https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPFrameworks/Tasks/InstallingFrameworks.html#//apple_ref/doc/uid/20002261-97286","link":"/blog/2018/12/12/frameworkEasy/"},{"title":"UICollectionViewLayoutInvalidationContextæ€§èƒ½ä¼˜åŒ– è¯¦ç»†æµç¨‹å›¾ + èŒƒä¾‹","text":"èµ·æ­¥åŸºç¡€ UICollectionViewLayout åŸºæœ¬ä½¿ç”¨ UICollectionViewLayoutAttributes Attributesèµ‹å€¼è¿™é‡Œæ³›æŒ‡äº†ä»¥ä¸‹ä¸¤ä¸ªä¸»å‡½æ•°ï¼Œå°±ä¸åœ¨èµ˜è¿°ä¸¤ä¸ªåŠŸèƒ½ï¼Œä»¥åŠ UICollectionViewLayoutAttributes éœ€å¤„ç†çš„å˜é‡ã€‚ 1234567891011class AutoSizingLayout: UICollectionViewLayout { override func prepare() { super.prepare() } override func layoutAttributesForElements(in rect: CGRect) -&gt; [UICollectionViewLayoutAttributes]? { return attributes }} Without Invalidatingå…ˆæ¥çœ‹çœ‹åœ¨ æ²¡æœ‰éœ€è¦é‡æ–°æ”¹å˜Attributes ä¸‹çš„æµç¨‹(ä»¥ä¸‹ç®€ç§° é…ç½®æµç¨‹)ï¼š data reloadæ—¶ï¼Œprepareè®¡ç®—ä¸€æ¬¡ï¼ŒlayoutAttributesForElementsè°ƒç”¨å¤šæ¬¡ç›´åˆ°ï¼Œç³»ç»Ÿå·²ç»æœ‰æ‰€æœ‰IndexPathçš„atrributeï¼Œå°±ä¸ä¼šåœ¨è°ƒç”¨è¿™äº›functiomï¼Œç›´åˆ°collectionView reloadã€‚ With Invalidatingç°åœ¨æˆ‘ä»¬æŠŠå¤±æ•ˆçš„æ¦‚å¿µåŠ è¿›æ¥ å¼ºåˆ¶å¤±æ•ˆ UICollectionViewLayout.invalidateLayout()invalidateLayout()å¯éšæ—¶å‘¼å«ï¼Œä»–ä¼šå°†æ‰€æœ‰ç³»ç»Ÿå·²å–å¾—çš„ Attribute å…¨éƒ¨æ ‡è®°ä¸º invalid å¹¶èˆå¼ƒã€‚ å‡†ç¡®çš„updateæ—¶æœºå¹¶ä¸æ˜¯è°ƒç”¨åï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€æ¬¡ layout çš„ update Cycleé‡Œåï¼Œé‡æ–°è°ƒç”¨prepare. å †æ ˆå¦‚å›¾ï¼š https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617728-invalidatelayout è‹¥æœ‰overrideræ­¤æ–¹æ³•ï¼Œå¿…é¡»call super.invalidateLayout() æ¡ä»¶å¤±æ•ˆ UICollectionViewLayout.shouldInvalidateLayout(forBoundsChange newBounds: CGRect) -&gt; Bool https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617781-shouldinvalidatelayout é»˜è®¤å›ä¼  falseã€‚ overrideråï¼Œå¯å€Ÿç”±ä¼ å…¥çš„ newBounds åˆ¤æ–­æ˜¯å¦éœ€è¦ invalidLayoutï¼Œè‹¥å›ä¼  true åˆ™è·Ÿ InvalidateLayout()ä¹‹åçš„æµç¨‹(å †æ ˆ)ç›¸åŒã€‚ ä¾‹å¦‚å†…å®¹ä¸‹åŠéƒ¨ï¼Œéœ€è¦ä¸æ–­æ›´æ–°Attribute 1234567override func shouldInvalidateLayout(forBoundsChange newBounds: CGRect) -&gt; Bool { guard let collectionView = collectionView else { return false } if newBounds.maxY &gt; contentSize.height / 2 { return true } return false} newBounds: CGRect æ­¤boundsçš„è§¦å‘æ—¶æœºï¼Œä¸ºcollectionViewå¯è§†èŒƒå›´æ”¹åŠ¨æ—¶(contentOffset Change) ä¸ºäº†ç®€åŒ–æµç¨‹å›¾ï¼Œæˆ‘ä»¬å°†å›ºå®šä¸€èµ·å‡ºç°çš„è¿™å‡ ä¸ªæ­¥éª¤ï¼Œåˆ’æˆä¸€ä¸ªï¼š UICollectionViewLayoutInvalidationContext (ä»¥ä¸‹ç®€ç§° InvalidationContext)https://developer.apple.com/documentation/uikit/uicollectionviewlayoutinvalidationcontext è¿™çš„contextè·Ÿå‡ºç°åœ¨å…¶ä»–åœ°æ–¹çš„Contextä¸Šä¸‹æ–‡æ¦‚å¿µå·®ä¸å¤šï¼Œå…ˆå€Ÿç”±ä¸€ä¸ªfunctionçš„å‚æ•°ï¼Œå¯¹æ­¤ä¸Šä¸‹æ–‡è¿›è¡Œè®¾ç½®ï¼Œå›ä¼ åå†ä¸‹ä¸€ä¸ªfunctionå¯¹è®¾ç½®çš„å†…å®¹è¿›è¡Œå¤„ç†ã€‚ åŸºäºç³»ç»Ÿã€åŸç”Ÿã€çš„ InvalidationContext å¤±æ•ˆlayout è¿™é‡Œå†å¤šè¦†å†™äº†ä¸¤ä¸ªå‡½æ•° invalidationContext(forBoundsChange:) å¯ä»¥å€Ÿç”±å‚æ•° bounds å¯¹context è¿›è¡Œéƒ¨åˆ†é€»è¾‘å¤„ç†ï¼Œä¹Ÿå¯åœ¨è¿™åš ã€å¤±æ•ˆæ ‡è®°ã€ https://developer.apple.com/documentation/uikit/uicollectionviewlayout/1617781-shouldinvalidatelayout 12345override func invalidationContext(forBoundsChange newBounds: CGRect) -&gt; UICollectionViewLayoutInvalidationContext { let invalidationContext = super.invalidationContext(forBoundsChange: newBounds) return invalidationContext} invalidateLayout(with:) æ ¹æ®ä¸Šä¸€éƒ¨å¤„ç†å¥½çš„é€»è¾‘æˆ– ã€å¤±æ•ˆæ ‡è®°ã€ åšå±æ€§å¤„ç†ï¼Œå¿…è°ƒç”¨super.invalidateLayout(with: invalidationContext) 123override func invalidateLayout(with context: UICollectionViewLayoutInvalidationContext) { //ä»¥contextçš„èµ„è®¯ï¼Œåšäº›update} ç³»ç»Ÿæä¾›å¯ç”¨çš„å¤±æ•ˆæ ‡è®°ï¼Œæ— ä»»ä½•æ ‡è®°å°†ä¼šé‡æ–°è¿›å…¥ã€é…ç½®æµç¨‹ã€ è¿™äº›æ ‡è®°çš„åŠŸç”¨ï¼Œæ˜¯åœ¨ç¬¬ä¸€ä¸ªfunctionæ ¹æ®boundsä½œä¸Šæ ‡è®°ï¼Œåœ¨ç¬¬äºŒä¸ªfuncitonä¸­å¯ä»¥æ ¹æ®ä»¥ä¸‹å¯¹åº”çš„å˜æ•°å–å¾—å½“åˆçš„æ ‡è®°ï¼Œåšå¯¹åº”çš„ã€å±€éƒ¨å±æ€§é¢„å¤„ç†ã€ã€‚ æœ‰æ ‡è®°å¯åš å±€éƒ¨å±æ€§é¢„å¤„ç† ï¼Œå¹¶ä¼šè¢«é‡æ–°è¯¢é—® Attribute é‡æ–°è¯¢é—® Attributeä¾‹å¦‚ï¼šè‹¥æ»‘è¶…è¿‡ 1/2 Yï¼Œä½¿ row 17 å¤±æ•ˆã€‚ 12345678override func invalidationContext(forBoundsChange newBounds: CGRect) -&gt; UICollectionViewLayoutInvalidationContext { let invalidationContext = super.invalidationContext(forBoundsChange: newBounds) if newBounds.maxY &gt; contentSize.height { invalidationContext.invalidateItems(at: [IndexPath(row: 17, section: 0)]) } return invalidationContext} è¦†å†™çš„æ­¤functionå°±ä¼šè¢«è°ƒç”¨å¹¶è¯¢é—® row17 çš„attribute 123override func layoutAttributesForItem(at indexPath: IndexPath) -&gt; UICollectionViewLayoutAttributes? { return row17's attribute} å±€éƒ¨å±æ€§é¢„å¤„ç†å±€éƒ¨å±æ€§é¢„å¤„ç† å…¶å®å°±æ˜¯ä¸ºäº†ä¸Šä¸€æ­¥ ã€é‡æ–°è¯¢é—® Attributeã€è¿™å—åšé¢„å…ˆè®¡ç®—ï¼Œ ä¾‹å¦‚ï¼šè‹¥æ»‘è¶…è¿‡ 1/2 Yï¼Œä½¿ æŸDecorationå¤±æ•ˆã€‚ 1234567891011override func invalidationContext(forBoundsChange newBounds: CGRect) -&gt; UICollectionViewLayoutInvalidationContext { let invalidationContext = super.invalidationContext(forBoundsChange: newBounds) if newBounds.maxY &gt; contentSize.height { invalidationContext.invalidateDecorationElements( ofKind: &quot;Footer&quot;, at: [IndexPath(item: 1, section: 0)] ) } return invalidationContext} å¹¶åœ¨ invalidateLayout(with:) ä»contexté‡ŒæŸ¥è¯¢æ˜¯å¦å¯¹åº”çš„DecorationåŒ…å«åœ¨å¤±æ•ˆåå•å†…ï¼Œå¹¶æå‰è®¡ç®—å¥½å¿ƒçš„Attributeå­˜åœ¨æŒæœ‰å˜é‡ 123456override func invalidateLayout(with context: UICollectionViewLayoutInvalidationContext) { let invalidationContext = context if let dic = context.invalidatedDecorationIndexPaths, let idx = dic[&quot;Footer&quot;] { prepareFooterViewAttributes() }} åœ¨è¯¢é—®çš„æ—¶å€™ï¼Œå°†é¢„å…ˆè®¡ç®—å¥½çš„Attribute å›ä¼  1234567override public func layoutAttributesForDecorationView( ofKind elementKind: String, at indexPath: IndexPath) -&gt; UICollectionViewLayoutAttributes? { return self.footerLayoutAttributes} ç‰¹æ®Šæ ‡è®° (get-only) è¿™ä¸¤ä¸ªç‰¹æ®Šæ ‡è®°æ˜¯ä¼šåœ¨è§¦å‘ collectionView.reloadData()æ—¶ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å¯ç”¨ï¼Œä¸èƒ½è‡ªå·±è®¾ç½®ï¼Œå¹¶ä¸”ä»ä¼šé‡æ–°è¿›å…¥ã€é…ç½®æµç¨‹ã€ã€‚ åŸºäºç³»ç»Ÿã€è‡ªå®šä¹‰ã€çš„ InvalidationContext å¤±æ•ˆlayoutç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å†™ä¸€ä¸ªç»§æ‰¿UICollectionViewLayoutInvalidationContextçš„ç±»ï¼Œå¹¶ä¸”åœ¨UICollectionViewLayoutç±»é‡Œè¦†å†™ä»¥ä¸‹ 123override class var invalidationContextClass: AnyClass { return InvalidationContextå­ç±»å.self} è‡ªå®šä¹‰ InvalidationContext çš„å¥½å¤„ä¸å¤–ä¹å°±æ˜¯èƒ½è‡ªå·±å¢åŠ å­—æ®µï¼Œèƒ½æ›´æ¸…æ™°ä¹Ÿæ›´æœ‰é€»è¾‘çš„è¡”æ¥å‰åä¸¤ä¸ªå‡½æ•° ä¾‹å¦‚ï¼šæ²¿ç”¨å‰é¢çš„ä¾‹å­ï¼Œä½†InvalidationContextä¸ºè‡ªå®šä¹‰ï¼Œå¢åŠ ä¸€ä¸ªBoolï¼Œåˆ¤æ–­å“ªéƒ¨åˆ†éœ€è¦å¤±æ•ˆæˆ–æ˜¯éœ€è¦è¢«æ ‡è®° 12345678910111213141516171819202122232425class LayoutInvalidationContext: UICollectionViewLayoutInvalidationContext { var invalidateFooter = false}override func invalidationContext(forBoundsChange newBounds: CGRect) -&gt; UICollectionViewLayoutInvalidationContext { let invalidationContext = super.invalidationContext(forBoundsChange: newBounds) as! LayoutInvalidationContext guard let collectionView = collectionView else { return invalidationContext } let originChanged = !collectionView.bounds.origin.equalTo(newBounds.origin) if originChanged &amp;&amp; newBounds.maxY &gt; contentSize.height { invalidationContext.invalidateFooter = true } return invalidationContext}override func invalidateLayout(with context: UICollectionViewLayoutInvalidationContext) { let invalidationContext = context as! LayoutInvalidationContext if invalidationContext.invalidateFooter { prepareFooterViewAttributes() invalidationContext.invalidateDecorationElements( ofKind: &quot;Footer&quot;, at: [IndexPath(item: 1, section: 0)] ) } super.invalidateLayout(with: invalidationContext)}","link":"/blog/2018/07/03/UICollectionViewLayoutInvalidationContext/"},{"title":"æ·±å…¥æ·ºå‡º Xcode å‘½ä»¤åˆ—(åŠ é¤) - libxcselect.dylib","text":"Xcodeå‘½ä»¤åˆ— = Xcode Command Lines Tool ç¶“éæ·±å…¥æ·ºå‡º Xcode å‘½ä»¤åˆ—(1) - åˆæ¢çš„ä»‹ç´¹ï¼Œæˆ‘å€‘çŸ¥é“ä¸€å°macä¸Šå¯èƒ½æœƒæœ‰å¤šâ€™çµ„â€™xcode command line tool. ä¸”åœ¨xcode-selectçš„å¹«åŠ©ä¸‹ï¼Œæˆ‘å€‘èƒ½æŒ‡å®šæŸå€‹ç‰¹å®šç‰ˆæœ¬çš„Command Line Toolsï¼Œç„¶å¾Œæ•´å°é›»è…¦åœ¨ä¸éœ€è¦è¨­å®šenvè®Šé‡çš„å‰æä¸‹ï¼Œå°±çŸ¥é“è©²èª¿é‚£å€‹SDKäº†â€¦. è½èµ·ä¾†å¾ˆç¬¦åˆç›´è¦ºï¼Œå»æœ‰é»å¤ªç„äº†â€¦ğŸ˜° â€“ è®“æˆ‘å€‘ç¨å¾®æ·±è¿½ä¸€ä¸‹é€™å•é¡Œ ç¤™æ–¼æˆ‘çš„çŸ¥è­˜æœ‰é™ï¼Œæ‰€ä»¥é€™ç¯‡å¯«åšåŠ é¤ï¼Œå’±å€‘é»åˆ°ç‚ºæ­¢ğŸ˜… things we knowè¤‡ç¿’ä¸€ä¸‹ï¼Œç•¶æˆ‘å€‘åœ¨çµ‚ç«¯æ•²å‘½ä»¤(ä¾‹å¦‚: xcodebuild)æ™‚ï¼Œç³»çµ±éƒ½æœƒåœ¨ $PATH é€™å€‹ç’°å¢ƒè®Šé‡è£¡çµ¦çš„è·¯å¾‘è£¡å°‹æ‰¾ä½ æ•²çš„æŒ‡ä»¤çš„object fileã€‚ echo $PATH æ‰€ä»¥è¼¸å…¥ git, å…¶å¯¦æ˜¯åŸ·è¡Œäº† /usr/bin/xcodebuild which git ä»¥ä¸Šéƒ½æ˜¯æˆ‘å€‘ç†ŸçŸ¥çš„åŸç†ã€‚ things we donâ€™t knowæˆ‘å€‘ç¾åœ¨å·²xcodebuildç‚ºä¾‹ï¼Œä¾†çœ‹çœ‹å¾Œé¢æœ‰é—œxcode command line toolsçš„æµç¨‹ã€‚ æˆ‘å°è©³ç´°çš„é€†å‘å‡½æ•¸é‚„ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥çµ±æ•´äº†ä¸€äº›åƒè€ƒæ–‡ç« ï¼Œæƒ³è¦æ·±å…¥æš¸è§£çš„å¯ä»¥é»æ“Šæ–‡ç« åº•éƒ¨éˆæ¥ã€‚ çœ‹çœ‹/usr/bin/xcodebuild ä¸‹çš„æŒ‡ä»¤æ˜¯æ€éº¼é…åˆxcode-select , æ‰¾åˆ° /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuildï¼Ÿ é¦–å…ˆæˆ‘å€‘å°±å° /usr/bin/xcodebuild å‹•æ‰‹åˆ—å‡º /usr/bin/xcodebuild çš„ textsection å†æ‰“å° /usr/bin/xcodebuild çš„ name list çµåˆé€™å…©å€‹ä¿¡æ¯ï¼Œæˆ‘å€‘å¯ä»¥å¾—å‡º èª¿ç”¨äº†ä¸€å€‹ _xcselect_invoke_xcrun å‡½æ•¸ é€™å€‹å‡½æ•¸å° /usr/bin/xcodebuild ä¾†èªªæ˜¯ä¸€å€‹å¤–éƒ¨ç¬¦è™Ÿï¼Œä¾†è‡ªå¦ä¸€å€‹å‹•æ…‹åº«ï¼Œäº¤çµ¦å‹•æ…‹éˆæ¥å»åšäº†ã€‚ æ¥è‘— æ‰“å° /usr/bin/xcodebuildä¾è³´çš„åº« å¯ä»¥çœ‹åˆ°æœ‰ libxcselect.dylib, libSystem.B.dylib, æ‰“å° libxcselect.dylib çš„ name list çœ‹çœ‹ _xcselect_invoke_xcruné€™symbol åœ¨ä¸åœ¨é€™ bingo! æ‰¾åˆ°äº† è·Ÿè‘— Swift-Swiftc ä½œè€…çš„è¿½è¹¤ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ 1234567libxcselect.dylib-&gt;_xcselect_invoke_xcrun-&gt; libxcrun.dylib-&gt;xcrun_main è€Œæœ€å¾Œçš„ xcrun_main -&gt; æŒ‡å‘çš„å°±æ˜¯ æŒ‡ä»¤ xcrun xcrunæˆªè‡³ç›®å‰ï¼Œæˆ‘å€‘èƒ½æŠŠä¸Šé¢çš„æ‰€æœ‰å †æ£§ï¼ŒæŠ½è±¡å¤§æ¦‚æ¿ƒç¸®æˆä¸€è¡Œå‡½æ•¸ï¼Œé¡ä¼¼æ–¼ xcrun('xcodebuild') è€Œxcrun å°±æœƒå¼•é ˜æˆ‘å€‘åˆ° /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild è‡³æ–¼xcrunçš„ç”¨æ³•ï¼Œæˆ‘å€‘ä¸‹å›åˆ†æ›‰ã€‚ æ’¥é›²è¦‹æ—¥ åƒè€ƒæ–‡ç« ï¼š Swift-Swiftc mans-special-xcode-support os-x-and-xcode-doing-it-apple-way","link":"/blog/2019/12/20/xcCmdLine-1_2/"},{"title":"å‘Heroè‡´æ•¬èˆ‡åˆ†æ-(äºŒ)","text":"æœ¬ç¯‡ç»§ä¸Šç¯‡ï¼šhttp://www.jianshu.com/p/fdab69f7440aæœ¬ç¯‡é‡ç‚¹ï¼š Plugin heroModifierString 1.3.1)Presentæµç¨‹ - start() - Plugin, HeroPreprocessor , HeroAnimator1234567public func animateTransition(using context: UIViewControllerContextTransitioning) { /* ç•¥.*/ start()} æˆ‘ä»¬æ¥åˆ°æœ€ä¸»è¦çš„ç¨‹å¼æ®µï¼šstart() 1234567891011func start() { plugins == nil { print(&quot;plugins == nil&quot;) //æŠŠenabledPluginsé‡Œçš„æ¯ä¸ªç±»åˆ«å…¨éƒ¨initåæ”¾è¿› plugins = Hero.enabledPlugins.map({ return $0.init() }) } /* ç•¥.*/} ä¸€å¼€å¤´å°±æ˜¯æˆ‘ä»¬æ²¡è§è¿‡çš„pluginsè¿™ä¸ªå˜æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥æµ…è°ˆpluginsæ˜¯ä»€ä¹ˆã€‚ Pluginæ˜¯Heroæä¾›å¯ä»¥è®©ä½¿ç”¨è€…ã€å¼€å‘è€…è‡ªè¡Œåœ¨åšè‡ªå®šä¹‰çš„å¤„ç†åŠ¨ç”»æˆ–æ˜¯å…¶ä»–å˜æ•°å¤„ç†ã€‚åªè¦è®©ç±»åˆ«å®ä½œHeroPlugin(ç»§æ‰¿HeroPreprocessor, HeroAnimatorä¸¤ä¸ªåå®š)è¿™ä¸ªç±»åˆ«ï¼Œå³å¯åœ¨è¿‡åœºçš„è¿›è¡Œæ—¶ï¼Œæ”¶åˆ°ä»¥ä¸‹é€šçŸ¥ï¼š ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹HeroPreprocessor, HeroAnimatorHeroæœ‰ä»¥ä¸‹ä¸¤ä¸ªå˜æ•°ï¼Œå¯ä»¥æŠŠå®ƒä»¬æƒ³æˆä¸¤æ¡çº¿ç¨‹ï¼Œä¸€æ¡ä¸“é—¨åšä¸€ç³»åˆ—çš„HeroPreprocessor, è€Œå¦ä¸€æ¡åˆ™åšä¸€ç³»åˆ—çš„HeroAnimatorã€‚ä¸Šé¢æåˆ°çš„PluginåŒæ—¶å±äºè¿™ä¸¤ç±»ã€‚ 123456789101112131415161718192021222324252627282930 var processors: [HeroPreprocessor]! var animators: [HeroAnimator]!func start() {/* ç•¥ */processors = Hero.builtInProcessors //Heroå†…å»ºç¨‹åºanimators = Hero.builtInAnimator //Heroå†…å»ºåŠ¨ç”» // å¦‚æœæœ‰æ’ä»¶çš„è¯å°±åŠ è¿›ç¨‹åº for plugin in plugins { processors.append(plugin) animators.append(plugin) }/* ç•¥ */// ask each preprocessor to process for processor in processors { processor.process(context:context, fromViews: context.fromViews, toViews: context.toViews) }/* ç•¥ */ for animator in animators.reversed() { let currentFromViews = fromViews.filterInPlace{ [context] (view:UIView) -&gt; Bool in return !animator.canAnimate(context: context!, view: view, appearing: false) } let currentToViews = toViews.filterInPlace{ [context] (view:UIView) -&gt; Bool in return !animator.canAnimate(context: context!, view: view, appearing: true) } animatorViews.insert((currentFromViews, currentToViews), at: 0) }} 1.3.2)Presentæµç¨‹ - start() - åˆ¶ä½œè¿‡åœºâ€èˆå°â€å¤åˆ¶ä¸€ä¸ªèµ·å§‹view(from view)ç›–ä¸Šå»(animatingViewContainer)ï¼Œä¹‹åæ‰€æœ‰åŠ¨ç”»éƒ½åœ¨ä¸Šé¢è¿›è¡Œï¼Œç®—æ˜¯æœ€å¥½æ‡‚çš„ä¸€å—ã€‚ 123456789101112131415161718func start() {/* ç•¥ */transitionContainer.isUserInteractionEnabled = false // a view to hold all the animation views //transitionContaineræ˜¯åœ¨contextæ‹¿åˆ°çš„ animatingViewContainer = UIView(frame: transitionContainer.bounds) transitionContainer.addSubview(animatingViewContainer) //åŠ ä¸Šä¸€ä¸ªç©ºçš„ç­‰å¤§å®¹å™¨ // create a snapshot view to hide all the flashing that might happen let completeSnapshot = fromView.snapshotView(afterScreenUpdates: true)! transitionContainer.addSubview(completeSnapshot) animatingViewContainer.addSubview(fromView) animatingViewContainer.insertSubview(toView, belowSubview: fromView) animatingViewContainer.backgroundColor = toView.backgroundColor/* ç•¥ */context = HeroContext(container:animatingViewContainer, fromView: fromView, toView:toView)} 1.4)HeroContextè¿™ä¸ªç±»åˆ«ç®—æ˜¯Heroçš„ç‰¹è‰²ä¹Ÿæ˜¯æœ€æœ‰æŠ€å·§æ€§çš„ä¸€éƒ¨åˆ†ã€‚ä¸»è¦å¤„ç†è¿™ä¸¤ä¸ª â€œHeroIDâ€, â€œheroModifierStringâ€ 1.4.1) heroModifierStringä¸€å¥è¯æ¦‚æ‹¬å®ƒï¼Œå°±æ˜¯â€œæŒ‡ä»¤â€ï¼ŒæŒ‡ç¤ºè¿™ä¸ªViewè¦æ‰§è¡Œæ€æ ·çš„è¿‡åœºåŠ¨ç”»ã€‚ä½¿ç”¨è€…åœ¨StoryBoardæˆ–æ˜¯swifté‡Œç»™å®šModifierStringåï¼Œå³åœ¨å˜æ•°çš„set{â€¦}å°†å­—ä¸²è½¬ä¸ºå¯æ‰§è¡Œçš„functionæŒ‡ä»¤ã€‚ 1234567891011121314151617181920212223public extension UIView{ /* ç•¥ */@IBInspectable public var heroModifierString: String? { /* ç•¥ */ let modifierString = newValue as NSString var modifiers = [HeroModifier]() //functionç»“æœ //modifiersRegex = &quot;(\\\\w+)(?:\\\\(([^\\\\)]*)\\\\))?&quot; for r in matches(for: modifiersRegex, text:modifierString) //A Loop { var parameters = [String]() if r.numberOfRanges &gt; 2, r.rangeAt(2).location &lt; modifierString.length { let parameterString = modifierString.substring(with: r.rangeAt(2)) as NSString //parameterRegex = &quot;(?:\\\\-?\\\\d+(\\\\.?\\\\d+)?)|\\\\w+&quot; for r in matches(for: parameterRegex, text: parameterString){ //B Loop parameters.append(parameterString.substring(with: r.range)) } } let name = modifierString.substring(with: r.rangeAt(1)) //å–å¾—Function if let modifier = HeroModifier.from(name: name, parameters: parameters){ modifiers.append(modifier) /*ç•¥*/ numberOfRangesï¼šregxçš„ç»„æ•°ï¼Œæœ€å¤–å±‚()çš„æ•°é‡ã€‚ rangeAt(0) = æœ‰ç¬¦åˆçš„ç»“æœ, rangeAt(1) = æœ‰ä¸€ç»„ä»¥ä¸Šï¼ŒrangeAt(2) = æœ‰ä¸¤ç»„ä»¥ä¸Šâ€¦â€¦ A Loop: æ‰¾å‡º ä¸€ä¸ªä»¥ä¸Šéç©ºç™½ å¯èƒ½å‡ºç°ä¸€å¯¹æ‹¬å· ä¸­é—´å¤¹ç€å¤šä¸ªéå³æ‹¬å· = ä¸€ä¸ªFuctionçš„æ ¼å¼ , è‹¥ numberOfRanges &gt; 2 åˆ™ä»£è¡¨æœ‰(å‚æ•°)ã€‚B Loop: å‚æ•° å¯æ˜¯ä¸€ä¸²éç©ºç™½ æˆ–æ˜¯ æ•°å­ï¼ˆå¯è´Ÿæ•°æˆ–å°æ•°) EX: heroModifierString = zPosition(2) arc parameterString = 2 , name = zPositionname = arc è¯»å‡ºä¸ªåˆ«æŒ‡ä»¤åå°±æ˜¯åˆ©ç”¨ä¸€ä¸ªé…å¯¹Functionï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆæ¯ä¸ªå­—ä¸²æœ‰é…å¯¹ç»“æœçš„è¯ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸ªçš„**â€é—­åŒ…ï¼ˆClosureï¼‰â€** 12345678910111213141516171819202122232425262728public class HeroModifier { internal let apply:(inout HeroTargetState) -&gt; Void public init(applyFunction:@escaping (inout HeroTargetState) -&gt; Void){ apply = applyFunction }/*ç•¥*/static func from(name:String, parameters:[String]) -&gt; HeroModifier?{switch name { case &quot;zPosition&quot;: if let zPosition = parameters.getCGFloat(0){ //æ‹¿å‚æ•° modifier = .zPosition(zPosition) }}/*ç•¥*/public static func zPosition(_ zPosition:CGFloat) -&gt; HeroModifier { return HeroModifier { targetState in targetState.zPosition = zPosition } }}/*ç•¥*/ public static func arc(intensity:CGFloat = 1) -&gt; HeroModifier { return HeroModifier { targetState in targetState.arc = intensity } } èµ°åˆ°è¿™ä¹ˆæ·±ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨åœ¨å›extension UIViewé¡¶å±‚çœ‹çœ‹å¦å¤–ä¸€ä¸ªæ‰©å……å˜æ•°ï¼Œ 123public extension UIView{/*ç•¥*/public var heroModifiers: [HeroModifier]? ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå¯æ‰§è¡Œçš„é—­åŒ…é›†åˆï¼Œå› ä¸ºæ¯ä¸ªHeroModifieréƒ½è‡ªå¸¦ä¸€ä¸ªé—­åŒ… apply:(inout HeroTargetState) -&gt; Void å®ƒè®°ç€ä¸€ä¸ªViewåœ¨è¿‡åœºæ—¶ï¼Œæ‰€æœ‰è¦æ‰§è¡Œçš„è¿‡åœºåŠ¨ç”»ï¼Œå¯åˆ©ç”¨modifier.apply(&amp;HeroTargetState)å‘¼å«ã€‚","link":"/blog/2017/01/18/Hero_Part2/"},{"title":"æ·±å…¥æ·ºå‡º Xcode å‘½ä»¤åˆ—(2)-xcrun åŸºç¤","text":"Xcodeå‘½ä»¤åˆ— = Xcode Command Lines Tool å‰è¨€å›é¡§ä¸€ä¸‹ä¸Šä¸€ç¯‡åŠ é¤, 1234567libxcselect.dylib-&gt;_xcselect_invoke_xcrun-&gt; libxcrun.dylib-&gt;xcrun_main æˆ‘å€‘æœ€å¾Œç™¼ç¾æ‰€æœ‰Xcode Command Line éƒ½æœƒå…ˆè¢«å°å‘ xcrun_mainï¼Œä¹Ÿå°±æ˜¯ xcrunã€‚ æ–¼æ˜¯xcrunå°±æˆäº†ç¬¬ä¸€å€‹æ¢è¨å°è±¡ xcrunxcrun æœ¬å : command-line tool runner, å¦‚æœæŠŠç¬¬ä¸€ç¯‡èªªçš„xcode-selectå½¢å®¹æˆå¤šçµ„Command Line toolsä¸­çš„å¼•è·¯äººï¼Œ xcrunå°±å¯ä»¥ç†è§£ç‚ºæŸä¸€çµ„Command Line toolsçš„æ•²é–€ç£šã€‚ å…ˆä¾†çœ‹xcrunçš„man, man xcrun æè¿°è£¡èªªçš„ï¼Œè·Ÿ xcode-selectåŸºæœ¬ä¸Šå¤§åŒå°ç•°ï¼Œä¾‹å¦‚ï¼š 12xcrun provides a means to locate or invoke developer tools from the command-line, without requiring users to modify Makefiles or otherwise take inconvenient measures to support multiple Xcode tool chains ä¸å¤–ä¹å°±æ˜¯èªªå¯ä»¥å†å¤šçµ„Command Line Toolsè£¡é¢æ‰¾åˆ°å®šä½åˆ°è©²åŸ·è¡Œçš„æŒ‡ä»¤ã€‚ æè¿°ç”šè‡³åœ¨é‚„æåˆ°äº†xcode-selectï¼Œå°±åƒæˆ‘ä¸Šé¢èªªçš„è¦èµ°åˆ°çœŸæ­£çš„executableï¼Œ æ˜¯ xcode-select(å¼•è·¯äºº)ã€xcrun(æ•²é–€ç£š) å…©ä½ç›¸è¼”ç›¸æˆæ‰èµ°å¾—åˆ°ã€‚ ç”±xcode-selct -s æ±ºå®šçš„xcode command Lineè·¯å¾‘ï¼Œxcrunå†ä¾ç…§é€™è·¯å¾‘ å®šä½ï¼åŸ·è¡Œå‘½ä»¤ã€‚ æŠŠç¬¬ä¸€ç¯‡çš„é€™å¼µåœ–æ“´å……ä¸€ä¸‹ï¼š Usageå·² Command line tools è£¡çš„ clang ç‚ºä¾‹: ä½œç‚ºåƒè€ƒ, xcode-select çš„ pathxcode-select -p/Applications/Xcode.app/Contents/Developer xcrun clang æ­¤æŒ‡ä»¤ç­‰åƒ¹æ–¼åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ â¬‡ï¸ clang /usr/bin/clang == (which clang) è©³æƒ…åƒè€ƒä¸Šä¸€ç¯‡åŠ é¤ /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang xcrun --find clang /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang xcrun --find git /Applications/Xcode.app/Contents/Developer/usr/bin/git Futher Moreä¸€èˆ¬ä»‹ç´¹xcrunçš„æ–‡ç« åˆ°é€™é‚Šå¤§æ¦‚å°±æœƒæ­¢ä½äº†ï¼Œå¤§æ¦‚çš„ç¸½çµï¼šxcrun å¾Œé¢æ¥æŒ‡ä»¤å°±å¯ä»¥æ€éº¼æ¨£æ€éº¼æ¨£ï¼Œç„¶å¾Œæ¥è‘—ä»‹ç´¹å¾Œé¢çš„æŒ‡ä»¤ã€‚ ä½†çœ‹åˆ° xcrun --find clang &amp; xcrun --find git çš„è¼¸å‡ºï¼Œ ä¸€å€‹æ˜¯ /Toolchains/XcodeDefault.xctoolchain/usr/bin/clang ä¸€å€‹æ˜¯ /usr/bin/git çµ¦æˆ‘ä¸€å€‹æ„Ÿè¦ºå°±æ˜¯ xcrun é™¤äº†èµ°xcode-selectæŒ‡å¼•çš„å¤§è·¯ï¼Œè‡ªå·±è£¡é¢é‚„æœ‰å¾ˆå¤šå°è·¯ï¼ æ‰€ä»¥æˆ‘æƒ³å°±é€™å€‹å•é¡Œåœ¨æ·±æŒ– xcrunã€‚è€Œçš„ç¢ºä¸€çµ„command line Toolsè£¡é‚„èƒ½åœ¨æ‹†åˆ†æˆä¸‰é¡çš„æŒ‡ä»¤ é€™ä¸‰å¤§é¡åˆ†åˆ¥ç‚º - Developer SDKs(Platforms) ToolChain é—œæ–¼é€™ä¸‰é¡ä¹‹é–“çš„ä¾è³´ï¼Œä»¥åŠxcrunå‰©é¤˜çš„ç”¨æ³•ï¼Œè«‹å…è¨±æˆ‘æ‹–æ›´åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ğŸ˜… reference: b-man/xcode-tools","link":"/blog/2019/12/23/xcCmdLine-2/"}],"tags":[{"name":"Model","slug":"Model","link":"/blog/tags/Model/"},{"name":"Codable","slug":"Codable","link":"/blog/tags/Codable/"},{"name":"iOS","slug":"iOS","link":"/blog/tags/iOS/"},{"name":"Xcode","slug":"Xcode","link":"/blog/tags/Xcode/"},{"name":"Compiler","slug":"Compiler","link":"/blog/tags/Compiler/"},{"name":"Clang","slug":"Clang","link":"/blog/tags/Clang/"},{"name":"LLVM","slug":"LLVM","link":"/blog/tags/LLVM/"},{"name":"MapKit","slug":"MapKit","link":"/blog/tags/MapKit/"},{"name":"åœ°åœ–","slug":"åœ°åœ–","link":"/blog/tags/%E5%9C%B0%E5%9C%96/"},{"name":"CGContext","slug":"CGContext","link":"/blog/tags/CGContext/"},{"name":"UIæ§ä»¶","slug":"UIæ§ä»¶","link":"/blog/tags/UI%E6%8E%A7%E4%BB%B6/"},{"name":"UIKit","slug":"UIKit","link":"/blog/tags/UIKit/"},{"name":"SpriteKit","slug":"SpriteKit","link":"/blog/tags/SpriteKit/"},{"name":"éå ´å‹•ç•«","slug":"éå ´å‹•ç•«","link":"/blog/tags/%E9%81%8E%E5%A0%B4%E5%8B%95%E7%95%AB/"},{"name":"WebView","slug":"WebView","link":"/blog/tags/WebView/"},{"name":"ç¶²è·¯","slug":"ç¶²è·¯","link":"/blog/tags/%E7%B6%B2%E8%B7%AF/"},{"name":"Command Line Tools","slug":"Command-Line-Tools","link":"/blog/tags/Command-Line-Tools/"},{"name":"xcode-select","slug":"xcode-select","link":"/blog/tags/xcode-select/"},{"name":"Framework","slug":"Framework","link":"/blog/tags/Framework/"},{"name":"åº«","slug":"åº«","link":"/blog/tags/%E5%BA%AB/"},{"name":"ColletionView","slug":"ColletionView","link":"/blog/tags/ColletionView/"},{"name":"xcrun","slug":"xcrun","link":"/blog/tags/xcrun/"}],"categories":[{"name":"iOS","slug":"iOS","link":"/blog/categories/iOS/"},{"name":"Xcode","slug":"Xcode","link":"/blog/categories/Xcode/"},{"name":"é–‹æºä»£ç¢¼","slug":"iOS/é–‹æºä»£ç¢¼","link":"/blog/categories/iOS/%E9%96%8B%E6%BA%90%E4%BB%A3%E7%A2%BC/"},{"name":"é–‹æºç ”ç©¶","slug":"iOS/é–‹æºç ”ç©¶","link":"/blog/categories/iOS/%E9%96%8B%E6%BA%90%E7%A0%94%E7%A9%B6/"},{"name":"Compiler","slug":"Xcode/Compiler","link":"/blog/categories/Xcode/Compiler/"},{"name":"Http","slug":"iOS/Http","link":"/blog/categories/iOS/Http/"},{"name":"å‘½ä»¤åˆ—","slug":"Xcode/å‘½ä»¤åˆ—","link":"/blog/categories/Xcode/%E5%91%BD%E4%BB%A4%E5%88%97/"},{"name":"Framework","slug":"Xcode/Framework","link":"/blog/categories/Xcode/Framework/"},{"name":"æ€§èƒ½å„ªåŒ–","slug":"iOS/æ€§èƒ½å„ªåŒ–","link":"/blog/categories/iOS/%E6%80%A7%E8%83%BD%E5%84%AA%E5%8C%96/"},{"name":"LLVM","slug":"Xcode/Compiler/LLVM","link":"/blog/categories/Xcode/Compiler/LLVM/"}]}